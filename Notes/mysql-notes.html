<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MySQL Database Study Notes</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #00758f 0%, #005a6f 100%);
        min-height: 100vh;
        display: flex;
      }

      /* Layout Container */
      .layout-container {
        display: flex;
        width: 100%;
        min-height: 100vh;
      }

      /* Sidebar Navigation */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 300px;
        height: 100vh;
        background: linear-gradient(
          180deg,
          rgba(0, 117, 143, 0.95) 0%,
          rgba(0, 90, 111, 0.95) 100%
        );
        backdrop-filter: blur(10px);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1001;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        overflow-y: auto;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar-header {
        background: linear-gradient(135deg, #00758f, #005a6f);
        color: white;
        padding: 20px;
        text-align: center;
        position: sticky;
        top: 0;
        z-index: 1002;
      }

      .sidebar-header h3 {
        font-size: 1.3rem;
        margin-bottom: 5px;
        font-weight: 700;
      }

      .sidebar-header p {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .sidebar-content {
        padding: 20px;
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
      }

      .sidebar li {
        margin-bottom: 8px;
      }

      .sidebar a {
        color: #ffffff;
        text-decoration: none;
        padding: 12px 15px;
        display: block;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-weight: 500;
        border-left: 4px solid transparent;
      }

      .sidebar a:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
        border-left-color: #4dd4ff;
      }

      .sidebar-toggle {
        position: fixed;
        top: 20px;
        left: 20px;
        background: linear-gradient(135deg, #00758f, #005a6f);
        color: white;
        border: none;
        padding: 12px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        z-index: 1003;
      }

      .sidebar-toggle:hover {
        background: linear-gradient(135deg, #005a6f, #00758f);
        transform: translateY(-2px);
      }

      .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(0, 0, 0, 0.5);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      /* Main Content */
      .main-content {
        flex: 1;
        margin-left: 0;
        transition: margin-left 0.3s ease;
      }

      .container {
        max-width: 1300px;
        margin: 0 auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.95);
        margin-top: 20px;
        margin-bottom: 20px;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-left: 90px;
        margin-right: 20px;
        transition: all 0.3s ease;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 0;
        background: linear-gradient(135deg, #00758f, #005a6f);
        color: white;
        border-radius: 10px;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        opacity: 0.3;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
        position: relative;
        z-index: 1;
      }

      .course-outline {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 30px;
        border-left: 5px solid #00758f;
      }

      .course-outline h2 {
        color: #005a6f;
        margin-bottom: 20px;
        font-size: 1.8em;
      }

      .lesson-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .lesson-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border-left: 4px solid #00758f;
      }

      .lesson-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      }

      .lesson {
        background: white;
        margin-bottom: 30px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .lesson:hover {
        transform: translateY(-5px);
      }

      .lesson-header {
        background: linear-gradient(135deg, #00758f, #005a6f);
        color: white;
        padding: 20px;
        position: relative;
      }

      .lesson-header::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #00758f, #4dd4ff, #005a6f, #00a6cc);
      }

      .lesson-header h2 {
        font-size: 1.8em;
        margin-bottom: 10px;
      }

      .lesson-content {
        padding: 25px;
      }

      .section {
        margin-bottom: 25px;
      }

      .section-title {
        color: #005a6f;
        font-size: 1.4em;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #ecf0f1;
        position: relative;
      }

      .section-title::before {
        content: "▶";
        color: #00758f;
        margin-right: 10px;
        font-size: 0.8em;
      }

      .subsection {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .subsection-title {
        color: #34495e;
        font-size: 1.2em;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .content-box {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #00758f;
      }

      .highlight-box {
        background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #00758f;
        position: relative;
      }

      .highlight-box::before {
        content: "💡";
        position: absolute;
        top: 15px;
        left: -12px;
        background: #00758f;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
      }

      .definition-box {
        background: linear-gradient(135deg, #fff9c4, #fff59d);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #fbc02d;
      }

      .code-box {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
      }

      .code-box pre {
        margin: 0;
        white-space: pre-wrap;
      }

      .sql-command {
        background: #00758f;
        color: #ffffff;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
        border-left: 4px solid #005a6f;
        font-size: 19px;
      }

      .sql-command pre {
        margin: 0;
        white-space: pre-wrap;
      }

      .sql-command .prompt {
        color: #4dd4ff;
      }

      .sql-command .comment {
        color: #a8d5e2;
      }

      ul,
      ol {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      li {
        margin-bottom: 8px;
        padding-left: 5px;
      }

      .component-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .component-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        border-top: 4px solid #00758f;
        transition: transform 0.3s ease;
      }

      .component-card:hover {
        transform: translateY(-5px);
      }

      .component-card h4 {
        color: #00758f;
        margin-bottom: 10px;
      }

      .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .comparison-table th {
        background: linear-gradient(135deg, #00758f, #005a6f);
        color: white;
        padding: 12px;
        text-align: left;
      }

      .comparison-table td {
        padding: 12px;
        border-bottom: 1px solid #ecf0f1;
      }

      .comparison-table tr:hover {
        background: #f8f9fa;
      }

      .back-to-main {
        position: fixed;
        top: 80px;
        left: 20px;
        background: linear-gradient(135deg, #005a6f, #00758f);
        color: white;
        text-decoration: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.9rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .back-to-main:hover {
        background: linear-gradient(135deg, #00758f, #005a6f);
        transform: translateY(-2px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
        color: white;
      }

      .back-to-main::before {
        content: "🏠";
        font-size: 1.1em;
      }

      .example-box {
        background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #0288d1;
      }

      .example-box h5 {
        color: #01579b;
        margin-bottom: 10px;
      }

      .warning-box {
        background: linear-gradient(135deg, #ffebee, #ffcdd2);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #f44336;
      }

      .warning-box::before {
        content: "⚠️";
        margin-right: 8px;
      }

      .mysql-icon {
        display: inline-block;
        background: #00758f;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        margin-right: 5px;
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 280px;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .container {
          margin: 10px;
          padding: 15px;
        }

        .sidebar-toggle {
          top: 10px;
          left: 10px;
          padding: 10px 12px;
        }

        .back-to-main {
          top: 60px;
          left: 10px;
          padding: 8px 15px;
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar Navigation -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>
    <a href="../index.html" class="back-to-main"></a>

    <div class="layout-container">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h3>📚 Course Navigation</h3>
          <p>MySQL Database</p>
        </div>
        <div class="sidebar-content">
          <ul>
            <li>
              <a href="#outline" onclick="closeSidebar()">📋 Course Outline</a>
            </li>
            <li>
              <a href="#lesson1" onclick="closeSidebar()">🗄️ MySQL Fundamentals</a>
            </li>
            <li>
              <a href="#lesson2" onclick="closeSidebar()">📊 Database Design</a>
            </li>
            <li>
              <a href="#lesson3" onclick="closeSidebar()">🔧 DDL Commands</a>
            </li>
            <li>
              <a href="#lesson4" onclick="closeSidebar()">📝 DML Commands</a>
            </li>
            <li>
              <a href="#lesson5" onclick="closeSidebar()">🔍 Advanced Queries</a>
            </li>
            <li>
              <a href="#lesson6" onclick="closeSidebar()">🔗 Joins & Relationships</a>
            </li>
            <li>
              <a href="#lesson7" onclick="closeSidebar()">⚡ Indexes & Performance</a>
            </li>
            <li>
              <a href="#lesson8" onclick="closeSidebar()">🔐 Security & Users</a>
            </li>
            <li>
              <a href="#lesson9" onclick="closeSidebar()">🚀 Advanced Topics</a>
            </li>
          </ul>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <div class="container" id="mainContainer">
          <div class="header">
            <h1>🐬 MySQL Database</h1>
            <p>Comprehensive Study Guide & Notes</p>
          </div>

          <section id="outline" class="course-outline">
            <h2>📚 Course Outline</h2>
            <div class="lesson-list">
              <div class="lesson-item">
                <strong>Module 1:</strong> MySQL Fundamentals & Architecture
              </div>
              <div class="lesson-item">
                <strong>Module 2:</strong> Database Design & Normalization
              </div>
              <div class="lesson-item">
                <strong>Module 3:</strong> DDL (Data Definition Language)
              </div>
              <div class="lesson-item">
                <strong>Module 4:</strong> DML (Data Manipulation Language)
              </div>
              <div class="lesson-item">
                <strong>Module 5:</strong> Advanced Queries & Functions
              </div>
              <div class="lesson-item">
                <strong>Module 6:</strong> Joins & Relationships
              </div>
              <div class="lesson-item">
                <strong>Module 7:</strong> Indexes & Performance Optimization
              </div>
              <div class="lesson-item">
                <strong>Module 8:</strong> Security & User Management
              </div>
              <div class="lesson-item">
                <strong>Module 9:</strong> Advanced Topics (Transactions, Views, Stored Procedures)
              </div>
            </div>
          </section>

          <div id="lesson1" class="lesson">
            <div class="lesson-header">
              <h2>Module 1: MySQL Fundamentals & Architecture</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">1.1 What is MySQL?</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>MySQL</strong> is an open-source relational database management system (RDBMS) that uses 
                    Structured Query Language (SQL) for accessing and managing data. It's one of the most popular 
                    databases in the world, used by companies like Facebook, Twitter, Netflix, and YouTube.
                  </p>
                </div>

                <div class="highlight-box">
                  <p><strong>Key Features:</strong></p>
                  <ul>
                    <li>📊 <strong>Relational Database:</strong> Data stored in tables with relationships</li>
                    <li>⚡ <strong>High Performance:</strong> Fast data retrieval and processing</li>
                    <li>🔒 <strong>Secure:</strong> User authentication and privilege management</li>
                    <li>🆓 <strong>Open Source:</strong> Free to use under GPL license</li>
                    <li>🔄 <strong>ACID Compliant:</strong> Ensures data integrity</li>
                    <li>📈 <strong>Scalable:</strong> Handles millions of records efficiently</li>
                    <li>🌐 <strong>Cross-Platform:</strong> Runs on Windows, Linux, macOS</li>
                    <li>🔌 <strong>Multi-Language Support:</strong> Works with PHP, Python, Java, Node.js, etc.</li>
                  </ul>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">1.2 MySQL Architecture</h3>
                
                <div class="code-box">
<pre style = "text-align:center;">
<strong>MySQL Architecture Layers:</strong>

┌─────────────────────────────────────────────────────────┐
│              Client Layer (Applications)                │
│  MySQL Workbench, PHP, Python, Java, Node.js, etc.      │
└────────────────────┬────────────────────────────────────┘
                     
┌────────────────────┴────────────────────────────────────┐
│                Connection Pool                          │
│  (Manages client connections, authentication)           │
└────────────────────┬────────────────────────────────────┘
                     
┌────────────────────┴────────────────────────────────────┐
│               SQL Interface Layer                       │
│  - Query Parser (syntax check)                          │
│  - Query Optimizer (find best execution plan)           │
│  - Query Executor                                       │
└────────────────────┬────────────────────────────────────┘
                     
┌────────────────────┴────────────────────────────────────┐
│                 Storage Engine Layer                    │
│  InnoDB (default), MyISAM, Memory, Archive, etc.        │
│  - Handles data storage and retrieval                   │
│  - Manages transactions, locking, indexing              │
└────────────────────┬────────────────────────────────────┘
                     
┌────────────────────┴────────────────────────────────────┐
│            Physical Storage (File System)               │
│  Data files, Index files, Log files                     │
└─────────────────────────────────────────────────────────┘
</pre>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Storage Engines</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Engine</th>
                        <th>Features</th>
                        <th>Use Cases</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>InnoDB</strong><br>(Default)</td>
                        <td>
                          ✅ ACID transactions<br>
                          ✅ Foreign keys<br>
                          ✅ Row-level locking<br>
                          ✅ Crash recovery
                        </td>
                        <td>General purpose, applications requiring transactions</td>
                      </tr>
                      <tr>
                        <td><strong>MyISAM</strong></td>
                        <td>
                          ⚡ Fast reads<br>
                          ❌ No transactions<br>
                          ❌ No foreign keys<br>
                          🔒 Table-level locking
                        </td>
                        <td>Read-heavy workloads, data warehousing</td>
                      </tr>
                      <tr>
                        <td><strong>Memory</strong></td>
                        <td>
                          ⚡ Extremely fast<br>
                          💾 Data in RAM<br>
                          ❌ Data lost on restart
                        </td>
                        <td>Temporary tables, caching, session data</td>
                      </tr>
                      <tr>
                        <td><strong>Archive</strong></td>
                        <td>
                          📦 High compression<br>
                          ❌ No indexes<br>
                          ✅ INSERT only
                        </td>
                        <td>Log data, historical records</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">1.3 RDBMS vs NoSQL</h3>
                
                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>RDBMS (MySQL)</th>
                      <th>NoSQL (MongoDB)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Data Model</strong></td>
                      <td>Structured tables with rows and columns</td>
                      <td>Flexible documents, key-value, graphs</td>
                    </tr>
                    <tr>
                      <td><strong>Schema</strong></td>
                      <td>Fixed schema (must be defined)</td>
                      <td>Dynamic schema (flexible)</td>
                    </tr>
                    <tr>
                      <td><strong>Relationships</strong></td>
                      <td>Foreign keys, joins</td>
                      <td>Embedded documents or references</td>
                    </tr>
                    <tr>
                      <td><strong>ACID</strong></td>
                      <td>✅ Full ACID compliance</td>
                      <td>⚠️ Eventual consistency (BASE)</td>
                    </tr>
                    <tr>
                      <td><strong>Scalability</strong></td>
                      <td>Vertical (add more power)</td>
                      <td>Horizontal (add more servers)</td>
                    </tr>
                    <tr>
                      <td><strong>Query Language</strong></td>
                      <td>SQL</td>
                      <td>Varies (MongoDB Query Language, etc.)</td>
                    </tr>
                    <tr>
                      <td><strong>Best For</strong></td>
                      <td>Complex queries, transactions, structured data</td>
                      <td>Rapid development, unstructured data, scalability</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">1.4 Getting Started with MySQL</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Connect to MySQL server</span>
<span class="prompt">$</span> mysql -u root -p
Enter password: ****

<span class="comment">-- Check MySQL version</span>
<span class="prompt">mysql></span> SELECT VERSION();
+-----------+
| VERSION() |
+-----------+
| 8.0.35    |
+-----------+

<span class="comment">-- Show current user</span>
<span class="prompt">mysql></span> SELECT USER();
+----------------+
| USER()         |
+----------------+
| root@localhost |
+----------------+

<span class="comment">-- Show all databases</span>
<span class="prompt">mysql></span> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+

<span class="comment">-- Create a new database</span>
<span class="prompt">mysql></span> CREATE DATABASE company;
Query OK, 1 row affected (0.02 sec)

<span class="comment">-- Select database to use</span>
<span class="prompt">mysql></span> USE company;
Database changed

<span class="comment">-- Show current database</span>
<span class="prompt">mysql></span> SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| company    |
+------------+

<span class="comment">-- Show all tables in current database</span>
<span class="prompt">mysql></span> SHOW TABLES;
Empty set (0.00 sec)

<span class="comment">-- Get help</span>
<span class="prompt">mysql></span> HELP;

<span class="comment">-- Exit MySQL</span>
<span class="prompt">mysql></span> EXIT;
Bye
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">1.5 MySQL Data Types</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">Numeric Data Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Range</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>TINYINT</strong></td>
                        <td>1 byte</td>
                        <td>-128 to 127 (or 0 to 255 unsigned)</td>
                        <td>Very small integer</td>
                      </tr>
                      <tr>
                        <td><strong>SMALLINT</strong></td>
                        <td>2 bytes</td>
                        <td>-32,768 to 32,767</td>
                        <td>Small integer</td>
                      </tr>
                      <tr>
                        <td><strong>MEDIUMINT</strong></td>
                        <td>3 bytes</td>
                        <td>-8,388,608 to 8,388,607</td>
                        <td>Medium integer</td>
                      </tr>
                      <tr>
                        <td><strong>INT</strong></td>
                        <td>4 bytes</td>
                        <td>-2,147,483,648 to 2,147,483,647</td>
                        <td>Standard integer</td>
                      </tr>
                      <tr>
                        <td><strong>BIGINT</strong></td>
                        <td>8 bytes</td>
                        <td>Very large range</td>
                        <td>Large integer</td>
                      </tr>
                      <tr>
                        <td><strong>DECIMAL(M,D)</strong></td>
                        <td>Variable</td>
                        <td>Exact precision</td>
                        <td>Fixed-point (money, precise calculations)</td>
                      </tr>
                      <tr>
                        <td><strong>FLOAT</strong></td>
                        <td>4 bytes</td>
                        <td>Approximate</td>
                        <td>Single-precision floating point</td>
                      </tr>
                      <tr>
                        <td><strong>DOUBLE</strong></td>
                        <td>8 bytes</td>
                        <td>Approximate</td>
                        <td>Double-precision floating point</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">String Data Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Max Size</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>CHAR(n)</strong></td>
                        <td>255 characters</td>
                        <td>Fixed-length string (padded with spaces)</td>
                      </tr>
                      <tr>
                        <td><strong>VARCHAR(n)</strong></td>
                        <td>65,535 characters</td>
                        <td>Variable-length string (most common)</td>
                      </tr>
                      <tr>
                        <td><strong>TINYTEXT</strong></td>
                        <td>255 characters</td>
                        <td>Tiny text string</td>
                      </tr>
                      <tr>
                        <td><strong>TEXT</strong></td>
                        <td>65,535 characters</td>
                        <td>Standard text string</td>
                      </tr>
                      <tr>
                        <td><strong>MEDIUMTEXT</strong></td>
                        <td>16,777,215 characters</td>
                        <td>Medium text string</td>
                      </tr>
                      <tr>
                        <td><strong>LONGTEXT</strong></td>
                        <td>4,294,967,295 characters</td>
                        <td>Very large text (articles, documents)</td>
                      </tr>
                      <tr>
                        <td><strong>ENUM</strong></td>
                        <td>65,535 values</td>
                        <td>Enumeration (list of allowed values)</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Date and Time Data Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Format</th>
                        <th>Range</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>DATE</strong></td>
                        <td>YYYY-MM-DD</td>
                        <td>1000-01-01 to 9999-12-31</td>
                      </tr>
                      <tr>
                        <td><strong>TIME</strong></td>
                        <td>HH:MM:SS</td>
                        <td>-838:59:59 to 838:59:59</td>
                      </tr>
                      <tr>
                        <td><strong>DATETIME</strong></td>
                        <td>YYYY-MM-DD HH:MM:SS</td>
                        <td>1000-01-01 00:00:00 to 9999-12-31 23:59:59</td>
                      </tr>
                      <tr>
                        <td><strong>TIMESTAMP</strong></td>
                        <td>YYYY-MM-DD HH:MM:SS</td>
                        <td>1970-01-01 00:00:01 to 2038-01-19 03:14:07</td>
                      </tr>
                      <tr>
                        <td><strong>YEAR</strong></td>
                        <td>YYYY</td>
                        <td>1901 to 2155</td>
                      </tr>
                    </tbody>
                  </table>

                  <div class="highlight-box">
                    <p><strong>DATETIME vs TIMESTAMP:</strong></p>
                    <ul>
                      <li><strong>DATETIME:</strong> Stores value as entered, doesn't change with timezone</li>
                      <li><strong>TIMESTAMP:</strong> Converts to UTC for storage, converts back to connection timezone on retrieval</li>
                      <li><strong>TIMESTAMP:</strong> Auto-updates to current timestamp on UPDATE (if set)</li>
                      <li><strong>Use DATETIME:</strong> For birth dates, appointment times</li>
                      <li><strong>Use TIMESTAMP:</strong> For created_at, updated_at fields</li>
                    </ul>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Binary Data Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Max Size</th>
                        <th>Use Case</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>BINARY(n)</strong></td>
                        <td>255 bytes</td>
                        <td>Fixed-length binary data</td>
                      </tr>
                      <tr>
                        <td><strong>VARBINARY(n)</strong></td>
                        <td>65,535 bytes</td>
                        <td>Variable-length binary data</td>
                      </tr>
                      <tr>
                        <td><strong>TINYBLOB</strong></td>
                        <td>255 bytes</td>
                        <td>Tiny binary data</td>
                      </tr>
                      <tr>
                        <td><strong>BLOB</strong></td>
                        <td>65KB</td>
                        <td>Small images, files</td>
                      </tr>
                      <tr>
                        <td><strong>MEDIUMBLOB</strong></td>
                        <td>16MB</td>
                        <td>Medium files, images</td>
                      </tr>
                      <tr>
                        <td><strong>LONGBLOB</strong></td>
                        <td>4GB</td>
                        <td>Large files (videos, documents)</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
                    <div id="lesson2" class="lesson">
            <div class="lesson-header">
              <h2>Module 2: Database Design & Normalization</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">2.1 Database Design Principles</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Database Design</strong> is the process of organizing data into tables and establishing 
                    relationships to ensure data integrity, minimize redundancy, and optimize performance.
                  </p>
                </div>

                <div class="highlight-box">
                  <p><strong>Key Design Goals:</strong></p>
                  <ul>
                    <li>📊 <strong>Data Integrity:</strong> Ensure data accuracy and consistency</li>
                    <li>🔄 <strong>Minimize Redundancy:</strong> Avoid storing duplicate data</li>
                    <li>⚡ <strong>Performance:</strong> Optimize for query speed</li>
                    <li>📈 <strong>Scalability:</strong> Design for growth</li>
                    <li>🔒 <strong>Security:</strong> Protect sensitive information</li>
                    <li>🛠️ <strong>Maintainability:</strong> Easy to update and modify</li>
                  </ul>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">2.2 Entity-Relationship (ER) Diagram</h3>
                
                <div class="code-box">
<pre style = "text-align:center;">
<strong>ER Diagram Components:</strong>

┌─────────────────────────────────────────────────────────┐
│                    ENTITY (Table)                       │
│  Represents a real-world object (Customer, Product)     │
│                                                         │
│  ┌─────────────┐                                        │
│  │  CUSTOMER   │                                        │
│  ├─────────────┤                                        │
│  │ customer_id │ ← Primary Key (PK)                     │
│  │ name        │                                        │
│  │ email       │                                        │
│  └─────────────┘                                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                   RELATIONSHIP                          │
│  Connects entities (Customer PLACES Order)              │
│                                                         │
│  Customer ────< Places >──── Order                      │
│   (One)                      (Many)                     │
│                                                         │
│  Cardinality Types:                                     │
│  • One-to-One (1:1)                                     │
│  • One-to-Many (1:N) - Most common                      │
│  • Many-to-Many (M:N) - Requires junction table         │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                    ATTRIBUTE (Column)                   │
│  Properties of an entity                                │
│                                                         │
│  Types:                                                 │
│  • Simple: Cannot be divided (age, name)                │
│  • Composite: Can be divided (address → street, city)   │
│  • Derived: Calculated from other attributes (age)      │
│  • Multi-valued: Multiple values (phone numbers)        │
└─────────────────────────────────────────────────────────┘
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: E-commerce Database Design</h5>
                  <div class="code-box">
<pre style = "text-align:center;">
CUSTOMERS                    ORDERS                      PRODUCTS
┌─────────────┐             ┌─────────────┐            ┌─────────────┐
│ customer_id │◄─────┐      │ order_id    │      ┌────►│ product_id  │
│ first_name  │      │      │ customer_id │──────┘     │ name        │
│ last_name   │      └──────│ order_date  │            │ price       │
│ email       │             │ total       │            │ stock       │
│ phone       │             │ status      │            │ category_id │
│ created_at  │             └─────────────┘            └─────────────┘
└─────────────┘                    │                          ▲
                                   │                          │
                            ORDER_ITEMS                       │
                           ┌─────────────┐                    │
                           │ order_id    │                    │
                           │ product_id  │────────────────────┘
                           │ quantity    │
                           │ price       │
                           └─────────────┘
                          (Junction Table)
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">2.3 Normalization</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Normalization</strong> is the process of organizing database tables to reduce redundancy 
                    and improve data integrity by dividing large tables into smaller ones and defining relationships.
                  </p>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Normal Forms</h4>
                  
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Normal Form</th>
                        <th>Requirements</th>
                        <th>Example Problem</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>1NF</strong><br>(First Normal Form)</td>
                        <td>
                          • Each cell contains atomic (single) values<br>
                          • No repeating groups<br>
                          • Each row is unique (has PK)
                        </td>
                        <td>
                          ❌ Phone: "123-4567, 890-1234"<br>
                          ✅ Separate rows or table for phones
                        </td>
                      </tr>
                      <tr>
                        <td><strong>2NF</strong><br>(Second Normal Form)</td>
                        <td>
                          • Must be in 1NF<br>
                          • No partial dependencies<br>
                          • Non-key columns fully depend on entire PK
                        </td>
                        <td>
                          ❌ Order table with product_name (depends only on product_id)<br>
                          ✅ Move product_name to Products table
                        </td>
                      </tr>
                      <tr>
                        <td><strong>3NF</strong><br>(Third Normal Form)</td>
                        <td>
                          • Must be in 2NF<br>
                          • No transitive dependencies<br>
                          • Non-key columns depend only on PK
                        </td>
                        <td>
                          ❌ Employee table with department_name (depends on department_id)<br>
                          ✅ Create Departments table
                        </td>
                      </tr>
                      <tr>
                        <td><strong>BCNF</strong><br>(Boyce-Codd NF)</td>
                        <td>
                          • Must be in 3NF<br>
                          • Every determinant is a candidate key<br>
                          • Stricter version of 3NF
                        </td>
                        <td>
                          Resolves anomalies in 3NF with overlapping candidate keys
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="example-box">
                  <h5>Example: Normalization Process</h5>
                  <div class="code-box">
<pre style = "text-align:center;"><span class="comment">-- Unnormalized (0NF)</span>
Orders Table:
┌──────────┬───────────┬──────────────────────────────────┬─────────┐
│ order_id │ customer  │ products                         │ total   │
├──────────┼───────────┼──────────────────────────────────┼─────────┤
│ 1        │ Alice     │ Laptop $999, Mouse $25           │ $1024   │
│ 2        │ Bob       │ Phone $799                       │ $799    │
└──────────┴───────────┴──────────────────────────────────┴─────────┘
<span class="comment">/* Problems: 
   - products column contains multiple values
   - Can't efficiently query individual products
   - Data redundancy */</span>

<span class="comment">-- 1NF: Atomic values</span>
Orders Table:
┌──────────┬────────────┬─────────────┬──────────┬───────┐
│ order_id │ customer   │ product     │ price    │ qty   │
├──────────┼────────────┼─────────────┼──────────┼───────┤
│ 1        │ Alice      │ Laptop      │ 999      │ 1     │
│ 1        │ Alice      │ Mouse       │ 25       │ 1     │
│ 2        │ Bob        │ Phone       │ 799      │ 1     │
└──────────┴────────────┴─────────────┴──────────┴───────┘
<span class="comment">/* Problems:
   - customer repeated for each product
   - product, price repeated across orders */</span>

<span class="comment">-- 2NF: Remove partial dependencies</span>
Orders Table:
┌──────────┬─────────────┬────────────┬─────────┐
│ order_id │ customer_id │ order_date │ total   │
├──────────┼─────────────┼────────────┼─────────┤
│ 1        │ 1           │ 2025-01-15 │ 1024    │
│ 2        │ 2           │ 2025-01-16 │ 799     │
└──────────┴─────────────┴────────────┴─────────┘

Order_Items Table:
┌──────────┬────────────┬──────────┬───────┐
│ order_id │ product_id │ price    │ qty   │
├──────────┼────────────┼──────────┼───────┤
│ 1        │ 1          │ 999      │ 1     │
│ 1        │ 2          │ 25       │ 1     │
│ 2        │ 3          │ 799      │ 1     │
└──────────┴────────────┴──────────┴───────┘

Products Table:
┌────────────┬─────────┬───────┐
│ product_id │ name    │ price │
├────────────┼─────────┼───────┤
│ 1          │ Laptop  │ 999   │
│ 2          │ Mouse   │ 25    │
│ 3          │ Phone   │ 799   │
└────────────┴─────────┴───────┘

<span class="comment">-- 3NF: Remove transitive dependencies</span>
Customers Table:
┌─────────────┬──────────┬─────────────────────┐
│ customer_id │ name     │ email               │
├─────────────┼──────────┼─────────────────────┤
│ 1           │ Alice    │ alice@example.com   │
│ 2           │ Bob      │ bob@example.com     │
└─────────────┴──────────┴─────────────────────┘

<span class="comment">/* Now in 3NF:
   ✅ No redundant data
   ✅ Easy to maintain
   ✅ Data integrity preserved
   ✅ Efficient queries with JOINs */</span>
</pre>
                  </div>
                </div>

                <div class="warning-box">
                  <strong>Denormalization:</strong> Sometimes, for performance reasons in read-heavy systems 
                  (OLAP/Analytics), you may intentionally denormalize by adding redundant data to avoid expensive JOINs. 
                  This is a trade-off between performance and data integrity.
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">2.4 Keys in Database Design</h3>
                
                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Key Type</th>
                      <th>Definition</th>
                      <th>Properties</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Primary Key (PK)</strong></td>
                      <td>Uniquely identifies each row in a table</td>
                      <td>
                        • Must be UNIQUE<br>
                        • Cannot be NULL<br>
                        • Only one per table<br>
                        • Usually an ID column
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Foreign Key (FK)</strong></td>
                      <td>Links two tables together</td>
                      <td>
                        • References PK of another table<br>
                        • Enforces referential integrity<br>
                        • Can be NULL<br>
                        • Can be duplicated
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Candidate Key</strong></td>
                      <td>Columns that could be primary key</td>
                      <td>
                        • Unique and NOT NULL<br>
                        • One becomes PK<br>
                        • Others become Alternate Keys
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Composite Key</strong></td>
                      <td>Primary key with multiple columns</td>
                      <td>
                        • Combination is unique<br>
                        • Common in junction tables<br>
                        • Each column may not be unique alone
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Unique Key</strong></td>
                      <td>Ensures column values are unique</td>
                      <td>
                        • Allows one NULL value<br>
                        • Multiple per table<br>
                        • Example: email, username
                      </td>
                    </tr>
                    <tr>
                      <td><strong>Super Key</strong></td>
                      <td>Any set of columns that uniquely identifies a row</td>
                      <td>
                        • Includes PK + other columns<br>
                        • May contain redundant columns
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">2.5 Referential Integrity</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Referential Integrity</strong> ensures that relationships between tables remain consistent. 
                    A foreign key value must either match a primary key value or be NULL.
                  </p>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">CASCADE Actions</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Action</th>
                        <th>Description</th>
                        <th>Use Case</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>CASCADE</strong></td>
                        <td>Automatically delete/update child rows</td>
                        <td>Delete customer → delete all their orders</td>
                      </tr>
                      <tr>
                        <td><strong>SET NULL</strong></td>
                        <td>Set FK to NULL when parent deleted</td>
                        <td>Delete manager → set employee's manager_id to NULL</td>
                      </tr>
                      <tr>
                        <td><strong>SET DEFAULT</strong></td>
                        <td>Set FK to default value</td>
                        <td>Set to "Unknown" category when category deleted</td>
                      </tr>
                      <tr>
                        <td><strong>RESTRICT/NO ACTION</strong></td>
                        <td>Prevent deletion if child rows exist</td>
                        <td>Can't delete category if products exist (safest)</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <div id="lesson3" class="lesson">
            <div class="lesson-header">
              <h2>Module 3: DDL (Data Definition Language)</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">3.1 DDL Overview</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>DDL (Data Definition Language)</strong> commands define and modify the database structure. 
                    These commands include CREATE, ALTER, DROP, TRUNCATE, and RENAME.
                  </p>
                </div>

                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Command</th>
                      <th>Purpose</th>
                      <th>Can be Rolled Back?</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>CREATE</strong></td>
                      <td>Creates database objects (database, table, index, view)</td>
                      <td>❌ No (auto-commit)</td>
                    </tr>
                    <tr>
                      <td><strong>ALTER</strong></td>
                      <td>Modifies existing database objects</td>
                      <td>❌ No (auto-commit)</td>
                    </tr>
                    <tr>
                      <td><strong>DROP</strong></td>
                      <td>Permanently deletes database objects</td>
                      <td>❌ No (auto-commit)</td>
                    </tr>
                    <tr>
                      <td><strong>TRUNCATE</strong></td>
                      <td>Removes all rows from table (keeps structure)</td>
                      <td>❌ No (auto-commit)</td>
                    </tr>
                    <tr>
                      <td><strong>RENAME</strong></td>
                      <td>Renames database objects</td>
                      <td>❌ No (auto-commit)</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">3.2 CREATE Commands</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">Create Database</h4>
                  <div class="sql-command">
<pre><span class="comment">-- Create database</span>
<span class="prompt">mysql></span> CREATE DATABASE company;
Query OK, 1 row affected (0.01 sec)

<span class="comment">-- Create database with character set and collation</span>
<span class="prompt">mysql></span> CREATE DATABASE company
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

<span class="comment">-- Create database if not exists (prevents error)</span>
<span class="prompt">mysql></span> CREATE DATABASE IF NOT EXISTS company;

<span class="comment">-- Check character set and collation</span>
<span class="prompt">mysql></span> SHOW CREATE DATABASE company;
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Create Table</h4>
                  <div class="sql-command">
<pre><span class="comment">-- Basic table creation</span>
<span class="prompt">mysql></span> CREATE TABLE employees (
    employee_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    hire_date DATE NOT NULL,
    salary DECIMAL(10, 2),
    department_id INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

<span class="comment">-- Table with constraints</span>
<span class="prompt">mysql></span> CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    order_date DATE NOT NULL,
    total_amount DECIMAL(10, 2) CHECK (total_amount >= 0),
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    
    <span class="comment">-- Foreign key constraint</span>
    CONSTRAINT fk_customer
        FOREIGN KEY (customer_id) 
        REFERENCES customers(customer_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    
    <span class="comment">-- Named constraints</span>
    CONSTRAINT chk_order_date CHECK (order_date >= '2020-01-01')
);

<span class="comment">-- Table with composite primary key</span>
<span class="prompt">mysql></span> CREATE TABLE order_items (
    order_id INT,
    product_id INT,
    quantity INT NOT NULL DEFAULT 1,
    price DECIMAL(10, 2) NOT NULL,
    
    PRIMARY KEY (order_id, product_id),
    
    FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE RESTRICT
);

<span class="comment">-- Create table from another table (copy structure and data)</span>
<span class="prompt">mysql></span> CREATE TABLE employees_backup AS
SELECT * FROM employees;

<span class="comment">-- Create table with only structure (no data)</span>
<span class="prompt">mysql></span> CREATE TABLE employees_template LIKE employees;

<span class="comment">-- Create temporary table (auto-deleted when session ends)</span>
<span class="prompt">mysql></span> CREATE TEMPORARY TABLE temp_sales AS
SELECT * FROM sales WHERE sale_date = CURDATE();
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Example: Complete Database Schema</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Create database</span>
CREATE DATABASE ecommerce;
USE ecommerce;

<span class="comment">-- Customers table</span>
CREATE TABLE customers (
    customer_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20),
    address VARCHAR(200),
    city VARCHAR(50),
    state VARCHAR(50),
    zip_code VARCHAR(10),
    country VARCHAR(50) DEFAULT 'USA',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_name (last_name, first_name)
);

<span class="comment">-- Categories table</span>
CREATE TABLE categories (
    category_id INT PRIMARY KEY AUTO_INCREMENT,
    category_name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

<span class="comment">-- Products table</span>
CREATE TABLE products (
    product_id INT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(200) NOT NULL,
    description TEXT,
    category_id INT,
    price DECIMAL(10, 2) NOT NULL CHECK (price >= 0),
    stock_quantity INT NOT NULL DEFAULT 0 CHECK (stock_quantity >= 0),
    image_url VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (category_id) REFERENCES categories(category_id) ON DELETE SET NULL,
    
    INDEX idx_category (category_id),
    INDEX idx_price (price),
    FULLTEXT INDEX idx_search (product_name, description)
);

<span class="comment">-- Orders table</span>
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_id INT NOT NULL,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(10, 2) NOT NULL CHECK (total_amount >= 0),
    status ENUM('pending', 'processing', 'shipped', 'delivered', 'cancelled') DEFAULT 'pending',
    shipping_address VARCHAR(200),
    payment_method VARCHAR(50),
    
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE RESTRICT,
    
    INDEX idx_customer (customer_id),
    INDEX idx_date (order_date),
    INDEX idx_status (status)
);

<span class="comment">-- Order Items table (junction table)</span>
CREATE TABLE order_items (
    order_item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL DEFAULT 1 CHECK (quantity > 0),
    unit_price DECIMAL(10, 2) NOT NULL CHECK (unit_price >= 0),
    subtotal DECIMAL(10, 2) GENERATED ALWAYS AS (quantity * unit_price) STORED,
    
    FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE RESTRICT,
    
    INDEX idx_order (order_id),
    INDEX idx_product (product_id)
);

<span class="comment">-- Reviews table</span>
CREATE TABLE reviews (
    review_id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    customer_id INT NOT NULL,
    rating TINYINT NOT NULL CHECK (rating BETWEEN 1 AND 5),
    review_text TEXT,
    review_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (product_id) REFERENCES products(product_id) ON DELETE CASCADE,
    FOREIGN KEY (customer_id) REFERENCES customers(customer_id) ON DELETE CASCADE,
    
    UNIQUE KEY unique_review (product_id, customer_id),
    INDEX idx_rating (rating)
);
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">3.3 ALTER Commands</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Add column</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD COLUMN middle_name VARCHAR(50) AFTER first_name;

<span class="comment">-- Add multiple columns</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD COLUMN birth_date DATE,
ADD COLUMN gender ENUM('M', 'F', 'Other');

<span class="comment">-- Modify column data type</span>
<span class="prompt">mysql></span> ALTER TABLE employees
MODIFY COLUMN salary DECIMAL(12, 2);

<span class="comment">-- Change column name and type</span>
<span class="prompt">mysql></span> ALTER TABLE employees
CHANGE COLUMN phone phone_number VARCHAR(15);

<span class="comment">-- Drop column</span>
<span class="prompt">mysql></span> ALTER TABLE employees
DROP COLUMN middle_name;

<span class="comment">-- Add primary key</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD PRIMARY KEY (employee_id);

<span class="comment">-- Drop primary key</span>
<span class="prompt">mysql></span> ALTER TABLE employees
DROP PRIMARY KEY;

<span class="comment">-- Add foreign key</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD CONSTRAINT fk_department
    FOREIGN KEY (department_id) 
    REFERENCES departments(department_id)
    ON DELETE SET NULL
    ON UPDATE CASCADE;

<span class="comment">-- Drop foreign key</span>
<span class="prompt">mysql></span> ALTER TABLE employees
DROP FOREIGN KEY fk_department;

<span class="comment">-- Add unique constraint</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD CONSTRAINT uq_email UNIQUE (email);

<span class="comment">-- Add check constraint (MySQL 8.0.16+)</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD CONSTRAINT chk_salary CHECK (salary > 0);

<span class="comment">-- Drop constraint</span>
<span class="prompt">mysql></span> ALTER TABLE employees
DROP CONSTRAINT chk_salary;

<span class="comment">-- Add index</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD INDEX idx_last_name (last_name);

<span class="comment">-- Add composite index</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ADD INDEX idx_name (last_name, first_name);

<span class="comment">-- Drop index</span>
<span class="prompt">mysql></span> ALTER TABLE employees
DROP INDEX idx_last_name;

<span class="comment">-- Rename table</span>
<span class="prompt">mysql></span> ALTER TABLE employees
RENAME TO staff;

<span class="comment">-- Change table engine</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ENGINE = InnoDB;

<span class="comment">-- Change table character set</span>
<span class="prompt">mysql></span> ALTER TABLE employees
CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

<span class="comment">-- Set default value</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ALTER COLUMN status SET DEFAULT 'active';

<span class="comment">-- Drop default value</span>
<span class="prompt">mysql></span> ALTER TABLE employees
ALTER COLUMN status DROP DEFAULT;

<span class="comment">-- Modify column to auto-increment</span>
<span class="prompt">mysql></span> ALTER TABLE employees
MODIFY COLUMN employee_id INT AUTO_INCREMENT;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">3.4 DROP, TRUNCATE, and RENAME</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- DROP: Permanently delete database objects</span>

<span class="comment">-- Drop database</span>
<span class="prompt">mysql></span> DROP DATABASE company;

<span class="comment">-- Drop database if exists (prevents error)</span>
<span class="prompt">mysql></span> DROP DATABASE IF EXISTS company;

<span class="comment">-- Drop table</span>
<span class="prompt">mysql></span> DROP TABLE employees;

<span class="comment">-- Drop multiple tables</span>
<span class="prompt">mysql></span> DROP TABLE IF EXISTS employees, departments, locations;

<span class="comment">-- Drop index</span>
<span class="prompt">mysql></span> DROP INDEX idx_name ON employees;

<span class="comment">-- TRUNCATE: Remove all rows (faster than DELETE, resets AUTO_INCREMENT)</span>
<span class="prompt">mysql></span> TRUNCATE TABLE employees;

<span class="comment">-- RENAME: Rename table</span>
<span class="prompt">mysql></span> RENAME TABLE employees TO staff;

<span class="comment">-- Rename multiple tables</span>
<span class="prompt">mysql></span> RENAME TABLE 
    old_customers TO customers_backup,
    new_customers TO customers;
</pre>
                </div>

                <div class="comparison-table">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>DROP TABLE</th>
                      <th>TRUNCATE TABLE</th>
                      <th>DELETE FROM</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Type</strong></td>
                      <td>DDL</td>
                      <td>DDL</td>
                      <td>DML</td>
                    </tr>
                    <tr>
                      <td><strong>Removes</strong></td>
                      <td>Table structure + data</td>
                      <td>All rows (keeps structure)</td>
                      <td>Specific rows</td>
                    </tr>
                    <tr>
                      <td><strong>AUTO_INCREMENT</strong></td>
                      <td>N/A (table deleted)</td>
                      <td>✅ Reset to 1</td>
                      <td>❌ Not reset</td>
                    </tr>
                    <tr>
                      <td><strong>WHERE Clause</strong></td>
                      <td>❌ No</td>
                      <td>❌ No</td>
                      <td>✅ Yes</td>
                    </tr>
                    <tr>
                      <td><strong>Triggers</strong></td>
                      <td>❌ Not fired</td>
                      <td>❌ Not fired</td>
                      <td>✅ Fired</td>
                    </tr>
                    <tr>
                      <td><strong>Rollback</strong></td>
                      <td>❌ No</td>
                      <td>❌ No (in most cases)</td>
                      <td>✅ Yes (with transaction)</td>
                    </tr>
                    <tr>
                      <td><strong>Speed</strong></td>
                      <td>Fast</td>
                      <td>Very fast</td>
                      <td>Slow (row-by-row)</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">3.5 Constraints</h3>
                
                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Constraint</th>
                      <th>Purpose</th>
                      <th>Example</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>NOT NULL</strong></td>
                      <td>Column cannot have NULL values</td>
                      <td><code>first_name VARCHAR(50) NOT NULL</code></td>
                    </tr>
                    <tr>
                      <td><strong>UNIQUE</strong></td>
                      <td>All values must be unique</td>
                      <td><code>email VARCHAR(100) UNIQUE</code></td>
                    </tr>
                    <tr>
                      <td><strong>PRIMARY KEY</strong></td>
                      <td>Uniquely identifies each row</td>
                      <td><code>employee_id INT PRIMARY KEY</code></td>
                    </tr>
                    <tr>
                      <td><strong>FOREIGN KEY</strong></td>
                      <td>Links to another table</td>
                      <td><code>FOREIGN KEY (dept_id) REFERENCES departments(id)</code></td>
                    </tr>
                    <tr>
                      <td><strong>CHECK</strong></td>
                      <td>Validates column values</td>
                      <td><code>age INT CHECK (age >= 18)</code></td>
                    </tr>
                    <tr>
                      <td><strong>DEFAULT</strong></td>
                      <td>Sets default value</td>
                      <td><code>status VARCHAR(20) DEFAULT 'active'</code></td>
                    </tr>
                    <tr>
                      <td><strong>AUTO_INCREMENT</strong></td>
                      <td>Automatically generates unique number</td>
                      <td><code>id INT AUTO_INCREMENT</code></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
                    <div id="lesson4" class="lesson">
            <div class="lesson-header">
              <h2>Module 4: DML (Data Manipulation Language)</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">4.1 DML Overview</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>DML (Data Manipulation Language)</strong> commands are used to manipulate data within 
                    tables. These commands include INSERT, UPDATE, and DELETE. Unlike DDL, DML changes can be 
                    rolled back within a transaction.
                  </p>
                </div>

                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Command</th>
                      <th>Purpose</th>
                      <th>Can be Rolled Back?</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>INSERT</strong></td>
                      <td>Add new rows to a table</td>
                      <td>✅ Yes (within transaction)</td>
                    </tr>
                    <tr>
                      <td><strong>UPDATE</strong></td>
                      <td>Modify existing rows</td>
                      <td>✅ Yes (within transaction)</td>
                    </tr>
                    <tr>
                      <td><strong>DELETE</strong></td>
                      <td>Remove rows from a table</td>
                      <td>✅ Yes (within transaction)</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">4.2 INSERT Statement</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Insert single row with all columns</span>
<span class="prompt">mysql></span> INSERT INTO employees (first_name, last_name, email, hire_date, salary, department_id)
VALUES ('John', 'Doe', 'john.doe@example.com', '2025-01-15', 50000.00, 1);

<span class="comment">-- Insert single row (omit optional columns)</span>
<span class="prompt">mysql></span> INSERT INTO employees (first_name, last_name, email, hire_date)
VALUES ('Jane', 'Smith', 'jane.smith@example.com', '2025-01-20');

<span class="comment">-- Insert multiple rows</span>
<span class="prompt">mysql></span> INSERT INTO employees (first_name, last_name, email, hire_date, salary, department_id)
VALUES 
    ('Alice', 'Johnson', 'alice@example.com', '2025-02-01', 60000, 2),
    ('Bob', 'Williams', 'bob@example.com', '2025-02-05', 55000, 1),
    ('Charlie', 'Brown', 'charlie@example.com', '2025-02-10', 52000, 3);

<span class="comment">-- Insert with AUTO_INCREMENT (omit ID column)</span>
<span class="prompt">mysql></span> INSERT INTO products (product_name, price, stock_quantity)
VALUES ('Laptop', 999.99, 50);

<span class="comment">-- Insert with default values</span>
<span class="prompt">mysql></span> INSERT INTO orders (customer_id, order_date)
VALUES (1, CURDATE());
<span class="comment">-- status will use default 'pending', total_amount defaults to NULL</span>

<span class="comment">-- Insert from SELECT (copy data from another table)</span>
<span class="prompt">mysql></span> INSERT INTO employees_archive (first_name, last_name, email, hire_date)
SELECT first_name, last_name, email, hire_date
FROM employees
WHERE hire_date < '2020-01-01';

<span class="comment">-- Insert with subquery</span>
<span class="prompt">mysql></span> INSERT INTO order_summary (customer_id, total_orders, total_spent)
SELECT customer_id, COUNT(*), SUM(total_amount)
FROM orders
GROUP BY customer_id;

<span class="comment">-- Insert with ON DUPLICATE KEY UPDATE (upsert)</span>
<span class="prompt">mysql></span> INSERT INTO products (product_id, product_name, price, stock_quantity)
VALUES (1, 'Laptop', 999.99, 50)
ON DUPLICATE KEY UPDATE 
    price = VALUES(price),
    stock_quantity = stock_quantity + VALUES(stock_quantity);
<span class="comment">-- If product_id=1 exists, update it; otherwise, insert new row</span>

<span class="comment">-- Insert with IGNORE (skip duplicates without error)</span>
<span class="prompt">mysql></span> INSERT IGNORE INTO customers (email, first_name, last_name)
VALUES ('john@example.com', 'John', 'Doe');
<span class="comment">-- If email already exists, skip this insert silently</span>

<span class="comment">-- Insert with RETURNING clause (MySQL 8.0.21+)</span>
<span class="prompt">mysql></span> INSERT INTO employees (first_name, last_name, email, hire_date)
VALUES ('David', 'Miller', 'david@example.com', CURDATE())
RETURNING employee_id, first_name, last_name;
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: Bulk Insert for E-commerce</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Insert customers</span>
INSERT INTO customers (first_name, last_name, email, phone, city, state, country)
VALUES 
    ('Alice', 'Johnson', 'alice@example.com', '555-0101', 'New York', 'NY', 'USA'),
    ('Bob', 'Smith', 'bob@example.com', '555-0102', 'Los Angeles', 'CA', 'USA'),
    ('Charlie', 'Brown', 'charlie@example.com', '555-0103', 'Chicago', 'IL', 'USA');

<span class="comment">-- Insert categories</span>
INSERT INTO categories (category_name, description)
VALUES 
    ('Electronics', 'Electronic devices and accessories'),
    ('Clothing', 'Apparel and fashion items'),
    ('Books', 'Books and educational materials');

<span class="comment">-- Insert products</span>
INSERT INTO products (product_name, category_id, price, stock_quantity)
VALUES 
    ('Laptop Pro 15', 1, 1299.99, 25),
    ('Wireless Mouse', 1, 29.99, 100),
    ('USB-C Cable', 1, 12.99, 200),
    ('T-Shirt Blue', 2, 19.99, 50),
    ('Jeans Classic', 2, 49.99, 30),
    ('Python Programming', 3, 39.99, 15);

<span class="comment">-- Insert orders</span>
INSERT INTO orders (customer_id, order_date, total_amount, status)
VALUES 
    (1, '2025-10-15', 1342.97, 'delivered'),
    (2, '2025-10-18', 82.97, 'shipped'),
    (3, '2025-10-19', 39.99, 'processing');

<span class="comment">-- Insert order items</span>
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
VALUES 
    (1, 1, 1, 1299.99),  <span class="comment">-- Laptop</span>
    (1, 2, 1, 29.99),    <span class="comment">-- Mouse</span>
    (1, 3, 1, 12.99),    <span class="comment">-- Cable</span>
    (2, 4, 2, 19.99),    <span class="comment">-- 2 T-shirts</span>
    (2, 5, 1, 49.99),    <span class="comment">-- Jeans</span>
    (3, 6, 1, 39.99);    <span class="comment">-- Book</span>
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">4.3 UPDATE Statement</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Update single column</span>
<span class="prompt">mysql></span> UPDATE employees
SET salary = 55000
WHERE employee_id = 1;

<span class="comment">-- Update multiple columns</span>
<span class="prompt">mysql></span> UPDATE employees
SET 
    salary = 60000,
    department_id = 2,
    updated_at = CURRENT_TIMESTAMP
WHERE employee_id = 1;

<span class="comment">-- Update with calculation</span>
<span class="prompt">mysql></span> UPDATE products
SET price = price * 1.10
WHERE category_id = 1;
<span class="comment">-- Increase prices by 10% for category 1</span>

<span class="comment">-- Update with CASE statement</span>
<span class="prompt">mysql></span> UPDATE employees
SET salary = CASE
    WHEN department_id = 1 THEN salary * 1.15
    WHEN department_id = 2 THEN salary * 1.10
    WHEN department_id = 3 THEN salary * 1.05
    ELSE salary
END
WHERE hire_date < '2023-01-01';

<span class="comment">-- Update with subquery</span>
<span class="prompt">mysql></span> UPDATE employees
SET salary = (
    SELECT AVG(salary)
    FROM employees e2
    WHERE e2.department_id = employees.department_id
)
WHERE salary IS NULL;

<span class="comment">-- Update with JOIN</span>
<span class="prompt">mysql></span> UPDATE products p
JOIN categories c ON p.category_id = c.category_id
SET p.price = p.price * 0.9
WHERE c.category_name = 'Electronics';
<span class="comment">-- 10% discount on all electronics</span>

<span class="comment">-- Update multiple tables (MySQL-specific)</span>
<span class="prompt">mysql></span> UPDATE orders o
JOIN customers c ON o.customer_id = c.customer_id
SET 
    o.status = 'priority',
    c.vip_status = TRUE
WHERE c.total_purchases > 10000;

<span class="comment">-- Update with LIMIT</span>
<span class="prompt">mysql></span> UPDATE products
SET is_active = FALSE
WHERE stock_quantity = 0
LIMIT 10;
<span class="comment">-- Only update first 10 matching rows</span>

<span class="comment">-- Update all rows (be careful!)</span>
<span class="prompt">mysql></span> UPDATE products
SET updated_at = CURRENT_TIMESTAMP;
<span class="comment">-- Updates ALL rows - no WHERE clause</span>

<span class="comment">-- Safe update mode (prevent accidental updates)</span>
<span class="prompt">mysql></span> SET SQL_SAFE_UPDATES = 1;
<span class="comment">-- Now UPDATE requires WHERE with key column or LIMIT</span>
</pre>
                </div>

                <div class="warning-box">
                  <strong>⚠️ Important UPDATE Safety Tips:</strong>
                  <ul>
                    <li>Always use WHERE clause unless you want to update all rows</li>
                    <li>Test with SELECT before UPDATE to verify which rows will be affected</li>
                    <li>Enable SQL_SAFE_UPDATES mode in development</li>
                    <li>Backup data before bulk updates in production</li>
                    <li>Use transactions for critical updates (BEGIN; UPDATE...; COMMIT;)</li>
                  </ul>
                </div>

                <div class="example-box">
                  <h5>Example: Complex Update Scenarios</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Scenario 1: Update order status based on date</span>
UPDATE orders
SET status = CASE
    WHEN order_date < DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND status = 'pending' THEN 'cancelled'
    WHEN order_date < DATE_SUB(CURDATE(), INTERVAL 7 DAY) AND status = 'processing' THEN 'delayed'
    ELSE status
END
WHERE status IN ('pending', 'processing');

<span class="comment">-- Scenario 2: Update product rankings based on sales</span>
UPDATE products p
JOIN (
    SELECT 
        product_id,
        SUM(quantity) as total_sold,
        RANK() OVER (ORDER BY SUM(quantity) DESC) as sales_rank
    FROM order_items
    GROUP BY product_id
) sales ON p.product_id = sales.product_id
SET p.popularity_rank = sales.sales_rank;

<span class="comment">-- Scenario 3: Update customer tier based on total purchases</span>
UPDATE customers
SET customer_tier = CASE
    WHEN (SELECT SUM(total_amount) FROM orders WHERE orders.customer_id = customers.customer_id) > 10000 THEN 'Platinum'
    WHEN (SELECT SUM(total_amount) FROM orders WHERE orders.customer_id = customers.customer_id) > 5000 THEN 'Gold'
    WHEN (SELECT SUM(total_amount) FROM orders WHERE orders.customer_id = customers.customer_id) > 1000 THEN 'Silver'
    ELSE 'Bronze'
END;

<span class="comment">-- Scenario 4: Sync inventory after returns</span>
UPDATE products p
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
SET p.stock_quantity = p.stock_quantity + oi.quantity
WHERE o.status = 'returned' AND o.updated_at > DATE_SUB(NOW(), INTERVAL 1 DAY);
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">4.4 DELETE Statement</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Delete single row</span>
<span class="prompt">mysql></span> DELETE FROM employees
WHERE employee_id = 1;

<span class="comment">-- Delete multiple rows with condition</span>
<span class="prompt">mysql></span> DELETE FROM orders
WHERE status = 'cancelled' AND order_date < '2023-01-01';

<span class="comment">-- Delete with subquery</span>
<span class="prompt">mysql></span> DELETE FROM products
WHERE category_id IN (
    SELECT category_id 
    FROM categories 
    WHERE is_active = FALSE
);

<span class="comment">-- Delete with JOIN (MySQL-specific)</span>
<span class="prompt">mysql></span> DELETE p
FROM products p
JOIN categories c ON p.category_id = c.category_id
WHERE c.category_name = 'Discontinued';

<span class="comment">-- Delete with LIMIT</span>
<span class="prompt">mysql></span> DELETE FROM logs
WHERE log_date < DATE_SUB(CURDATE(), INTERVAL 90 DAY)
LIMIT 1000;
<span class="comment">-- Delete in batches to avoid locking table</span>

<span class="comment">-- Delete all rows (use TRUNCATE instead for better performance)</span>
<span class="prompt">mysql></span> DELETE FROM temp_table;

<span class="comment">-- Delete with ORDER BY and LIMIT (delete oldest)</span>
<span class="prompt">mysql></span> DELETE FROM audit_logs
ORDER BY created_at ASC
LIMIT 100;

<span class="comment">-- Delete orphaned records (records without parent)</span>
<span class="prompt">mysql></span> DELETE FROM order_items
WHERE order_id NOT IN (SELECT order_id FROM orders);

<span class="comment">-- Safe delete mode</span>
<span class="prompt">mysql></span> SET SQL_SAFE_UPDATES = 1;
<span class="comment">-- Requires WHERE with key column or LIMIT</span>
</pre>
                </div>

                <div class="comparison-table">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>DELETE</th>
                      <th>TRUNCATE</th>
                      <th>DROP</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Command Type</strong></td>
                      <td>DML</td>
                      <td>DDL</td>
                      <td>DDL</td>
                    </tr>
                    <tr>
                      <td><strong>Removes</strong></td>
                      <td>Specific rows (with WHERE)</td>
                      <td>All rows</td>
                      <td>Entire table</td>
                    </tr>
                    <tr>
                      <td><strong>Rollback</strong></td>
                      <td>✅ Yes (in transaction)</td>
                      <td>❌ No</td>
                      <td>❌ No</td>
                    </tr>
                    <tr>
                      <td><strong>Triggers</strong></td>
                      <td>✅ Fires DELETE triggers</td>
                      <td>❌ No triggers</td>
                      <td>❌ No triggers</td>
                    </tr>
                    <tr>
                      <td><strong>WHERE Clause</strong></td>
                      <td>✅ Yes</td>
                      <td>❌ No</td>
                      <td>❌ No</td>
                    </tr>
                    <tr>
                      <td><strong>AUTO_INCREMENT</strong></td>
                      <td>❌ Not reset</td>
                      <td>✅ Reset to 1</td>
                      <td>N/A</td>
                    </tr>
                    <tr>
                      <td><strong>Speed</strong></td>
                      <td>Slow (row-by-row)</td>
                      <td>Very fast</td>
                      <td>Very fast</td>
                    </tr>
                    <tr>
                      <td><strong>Table Structure</strong></td>
                      <td>✅ Preserved</td>
                      <td>✅ Preserved</td>
                      <td>❌ Deleted</td>
                    </tr>
                  </tbody>
                </table>

                <div class="example-box">
                  <h5>Example: Safe Deletion Practices</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Step 1: Preview what will be deleted</span>
SELECT * FROM orders
WHERE status = 'cancelled' AND order_date < '2023-01-01';

<span class="comment">-- Step 2: Count rows to be deleted</span>
SELECT COUNT(*) FROM orders
WHERE status = 'cancelled' AND order_date < '2023-01-01';

<span class="comment">-- Step 3: Backup data before deletion</span>
CREATE TABLE orders_deleted_backup AS
SELECT * FROM orders
WHERE status = 'cancelled' AND order_date < '2023-01-01';

<span class="comment">-- Step 4: Delete within transaction (can rollback if needed)</span>
START TRANSACTION;

DELETE FROM orders
WHERE status = 'cancelled' AND order_date < '2023-01-01';

<span class="comment">-- Verify deletion</span>
SELECT COUNT(*) FROM orders WHERE status = 'cancelled';

<span class="comment">-- If satisfied, commit; otherwise rollback</span>
COMMIT;
<span class="comment">-- Or: ROLLBACK;</span>

<span class="comment">-- Batch deletion for large tables (avoid long locks)</span>
DELIMITER $$
CREATE PROCEDURE batch_delete_old_logs()
BEGIN
    DECLARE deleted_rows INT DEFAULT 1;
    
    WHILE deleted_rows > 0 DO
        DELETE FROM logs
        WHERE created_at < DATE_SUB(CURDATE(), INTERVAL 90 DAY)
        LIMIT 1000;
        
        SET deleted_rows = ROW_COUNT();
        
        <span class="comment">-- Brief pause to reduce server load</span>
        SELECT SLEEP(0.1);
    END WHILE;
END$$
DELIMITER ;

CALL batch_delete_old_logs();
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">4.5 Transaction Management</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Transactions</strong> ensure data integrity by grouping multiple DML operations into a 
                    single atomic unit. Either all operations succeed (COMMIT) or all fail (ROLLBACK).
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Start transaction</span>
<span class="prompt">mysql></span> START TRANSACTION;
<span class="comment">-- Or: BEGIN;</span>

<span class="comment">-- Perform operations</span>
<span class="prompt">mysql></span> UPDATE accounts SET balance = balance - 1000 WHERE account_id = 1;
<span class="prompt">mysql></span> UPDATE accounts SET balance = balance + 1000 WHERE account_id = 2;

<span class="comment">-- Commit if all successful</span>
<span class="prompt">mysql></span> COMMIT;

<span class="comment">-- Or rollback if something went wrong</span>
<span class="prompt">mysql></span> ROLLBACK;

<span class="comment">-- Set savepoint (partial rollback)</span>
<span class="prompt">mysql></span> START TRANSACTION;
<span class="prompt">mysql></span> INSERT INTO orders (customer_id, total_amount) VALUES (1, 100);
<span class="prompt">mysql></span> SAVEPOINT sp1;
<span class="prompt">mysql></span> INSERT INTO orders (customer_id, total_amount) VALUES (2, 200);
<span class="prompt">mysql></span> SAVEPOINT sp2;
<span class="prompt">mysql></span> INSERT INTO orders (customer_id, total_amount) VALUES (3, 300);

<span class="comment">-- Rollback to savepoint (keeps first two inserts)</span>
<span class="prompt">mysql></span> ROLLBACK TO SAVEPOINT sp2;

<span class="prompt">mysql></span> COMMIT;

<span class="comment">-- Auto-commit mode</span>
<span class="prompt">mysql></span> SET autocommit = 0;  <span class="comment">-- Disable auto-commit</span>
<span class="comment">-- Now must manually COMMIT or ROLLBACK</span>

<span class="prompt">mysql></span> SET autocommit = 1;  <span class="comment">-- Enable auto-commit (default)</span>

<span class="comment">-- Transaction with error handling</span>
DELIMITER $$
CREATE PROCEDURE transfer_funds(
    IN from_account INT,
    IN to_account INT,
    IN amount DECIMAL(10,2)
)
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SELECT 'Transaction failed and rolled back' AS message;
    END;
    
    START TRANSACTION;
    
    UPDATE accounts 
    SET balance = balance - amount 
    WHERE account_id = from_account AND balance >= amount;
    
    IF ROW_COUNT() = 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Insufficient funds';
    END IF;
    
    UPDATE accounts 
    SET balance = balance + amount 
    WHERE account_id = to_account;
    
    COMMIT;
    SELECT 'Transaction successful' AS message;
END$$
DELIMITER ;
</pre>
                </div>

                <div class="highlight-box">
                  <p><strong>ACID Properties:</strong></p>
                  <ul>
                    <li><strong>A</strong>tomicity: All operations succeed or all fail</li>
                    <li><strong>C</strong>onsistency: Database moves from one valid state to another</li>
                    <li><strong>I</strong>solation: Concurrent transactions don't interfere</li>
                    <li><strong>D</strong>urability: Committed changes are permanent</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div id="lesson5" class="lesson">
            <div class="lesson-header">
              <h2>Module 5: DQL & Advanced Queries</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">5.1 SELECT Statement Basics</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>SELECT</strong> is the core of querying data. It retrieves data from one or more tables 
                    based on specified criteria. The query is composed of clauses that execute in a specific order.
                  </p>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Query Execution Order</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Order</th>
                        <th>Clause</th>
                        <th>Purpose</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>1st</strong></td>
                        <td>FROM</td>
                        <td>Specifies the table(s) - establishes base data set</td>
                      </tr>
                      <tr>
                        <td><strong>2nd</strong></td>
                        <td>WHERE</td>
                        <td>Filters rows BEFORE aggregation</td>
                      </tr>
                      <tr>
                        <td><strong>3rd</strong></td>
                        <td>GROUP BY</td>
                        <td>Groups rows with same values for aggregation</td>
                      </tr>
                      <tr>
                        <td><strong>4th</strong></td>
                        <td>HAVING</td>
                        <td>Filters groups AFTER aggregation (requires GROUP BY)</td>
                      </tr>
                      <tr>
                        <td><strong>5th</strong></td>
                        <td>SELECT</td>
                        <td>Picks columns to display (including aggregations)</td>
                      </tr>
                      <tr>
                        <td><strong>6th</strong></td>
                        <td>ORDER BY</td>
                        <td>Sorts result set (ASC or DESC)</td>
                      </tr>
                      <tr>
                        <td><strong>7th</strong></td>
                        <td>LIMIT</td>
                        <td>Restricts number of rows returned</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Basic SELECT</span>
<span class="prompt">mysql></span> SELECT * FROM employees;

<span class="comment">-- Select specific columns</span>
<span class="prompt">mysql></span> SELECT first_name, last_name, email FROM employees;

<span class="comment">-- Select with alias</span>
<span class="prompt">mysql></span> SELECT 
    first_name AS 'First Name',
    last_name AS 'Last Name',
    salary * 12 AS 'Annual Salary'
FROM employees;

<span class="comment">-- Select DISTINCT (unique values)</span>
<span class="prompt">mysql></span> SELECT DISTINCT department_id FROM employees;

<span class="comment">-- Select with calculation</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    price,
    price * 0.9 AS 'Sale Price',
    price - (price * 0.9) AS 'Discount Amount'
FROM products;

<span class="comment">-- Select with LIMIT</span>
<span class="prompt">mysql></span> SELECT * FROM customers LIMIT 10;

<span class="comment">-- Select with LIMIT and OFFSET (pagination)</span>
<span class="prompt">mysql></span> SELECT * FROM customers 
LIMIT 10 OFFSET 20;
<span class="comment">-- Skip first 20 rows, return next 10</span>

<span class="comment">-- Shorter syntax for LIMIT with OFFSET</span>
<span class="prompt">mysql></span> SELECT * FROM customers 
LIMIT 20, 10;
<span class="comment">-- Same as LIMIT 10 OFFSET 20</span>
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">5.2 WHERE Clause and Filtering</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">Comparison Operators</h4>
                  <div class="sql-command">
<pre><span class="comment">-- Equality</span>
<span class="prompt">mysql></span> SELECT * FROM employees WHERE department_id = 1;

<span class="comment">-- Not equal</span>
<span class="prompt">mysql></span> SELECT * FROM employees WHERE department_id != 1;
<span class="prompt">mysql></span> SELECT * FROM employees WHERE department_id <> 1;

<span class="comment">-- Greater than / Less than</span>
<span class="prompt">mysql></span> SELECT * FROM products WHERE price > 100;
<span class="prompt">mysql></span> SELECT * FROM products WHERE stock_quantity < 10;

<span class="comment">-- Greater than or equal / Less than or equal</span>
<span class="prompt">mysql></span> SELECT * FROM employees WHERE salary >= 50000;
<span class="prompt">mysql></span> SELECT * FROM orders WHERE order_date <= '2025-10-20';
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Logical Operators</h4>
                  <div class="sql-command">
<pre><span class="comment">-- AND (all conditions must be TRUE)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE department_id = 1 AND salary > 50000;

<span class="comment">-- OR (at least one condition must be TRUE)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE department_id = 1 OR department_id = 2;

<span class="comment">-- NOT (reverses condition)</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE NOT category_id = 1;

<span class="comment">-- Combining logical operators (use parentheses for clarity)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE (department_id = 1 OR department_id = 2) 
  AND salary > 50000;
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Range and Membership Operators</h4>
                  <div class="sql-command">
<pre><span class="comment">-- BETWEEN (inclusive range)</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE price BETWEEN 100 AND 500;
<span class="comment">-- Equivalent to: price >= 100 AND price <= 500</span>

<span class="comment">-- NOT BETWEEN</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE price NOT BETWEEN 100 AND 500;

<span class="comment">-- IN (matches any value in list)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE department_id IN (1, 2, 3);
<span class="comment">-- Equivalent to: department_id = 1 OR department_id = 2 OR department_id = 3</span>

<span class="comment">-- NOT IN</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE department_id NOT IN (1, 2, 3);

<span class="comment">-- IN with subquery</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE category_id IN (
    SELECT category_id 
    FROM categories 
    WHERE is_active = TRUE
);
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Pattern Matching with LIKE</h4>
                  <div class="sql-command">
<pre><span class="comment">-- LIKE with wildcards
-- % = any sequence of zero or more characters
-- _ = exactly one character</span>

<span class="comment">-- Starts with 'John'</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE first_name LIKE 'John%';

<span class="comment">-- Ends with 'son'</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE last_name LIKE '%son';

<span class="comment">-- Contains 'tech'</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE product_name LIKE '%tech%';

<span class="comment">-- Exact length (5 characters)</span>
<span class="prompt">mysql></span> SELECT * FROM products 
WHERE product_code LIKE '_____';

<span class="comment">-- Starts with 'J' and is 4 characters long</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE first_name LIKE 'J___';

<span class="comment">-- NOT LIKE</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE email NOT LIKE '%@gmail.com';

<span class="comment">-- Case-insensitive by default in MySQL
-- For case-sensitive, use BINARY</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE BINARY first_name LIKE 'john%';
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">NULL Handling</h4>
                  <div class="sql-command">
<pre><span class="comment">-- IS NULL (check for NULL values)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE phone IS NULL;

<span class="comment">-- IS NOT NULL (check for non-NULL values)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE phone IS NOT NULL;

<span class="comment">-- ⚠️ WRONG: Never use = or != with NULL</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE phone = NULL;      <span class="comment">-- Returns no rows!</span>

<span class="prompt">mysql></span> SELECT * FROM employees 
WHERE phone != NULL;     <span class="comment">-- Returns no rows!</span>

<span class="comment">-- COALESCE (return first non-NULL value)</span>
<span class="prompt">mysql></span> SELECT 
    first_name,
    COALESCE(phone, email, 'No contact info') AS contact
FROM employees;

<span class="comment">-- IFNULL (MySQL-specific, 2 arguments only)</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    IFNULL(discount_price, price) AS final_price
FROM products;

<span class="comment">-- NULLIF (returns NULL if two values are equal)</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    NULLIF(stock_quantity, 0) AS stock
FROM products;
<span class="comment">-- Returns NULL for products with 0 stock</span>
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">5.3 Sorting and Ordering</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- ORDER BY ascending (default)</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
ORDER BY last_name;

<span class="comment">-- ORDER BY descending</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
ORDER BY salary DESC;

<span class="comment">-- Order by multiple columns</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
ORDER BY department_id ASC, salary DESC;
<span class="comment">-- First sort by department (A-Z), then by salary (high to low)</span>

<span class="comment">-- Order by column position (not recommended, less readable)</span>
<span class="prompt">mysql></span> SELECT first_name, last_name, salary 
FROM employees 
ORDER BY 3 DESC;
<span class="comment">-- Orders by 3rd column (salary)</span>

<span class="comment">-- Order by calculated column</span>
<span class="prompt">mysql></span> SELECT 
    first_name,
    last_name,
    salary * 12 AS annual_salary
FROM employees 
ORDER BY annual_salary DESC;

<span class="comment">-- Order with NULLS handling</span>
<span class="prompt">mysql></span> SELECT * FROM employees 
ORDER BY commission_pct IS NULL, commission_pct DESC;
<span class="comment">-- Shows non-NULL values first, then NULLs</span>

<span class="comment">-- Order with CASE for custom sorting</span>
<span class="prompt">mysql></span> SELECT * FROM orders 
ORDER BY 
    CASE status
        WHEN 'urgent' THEN 1
        WHEN 'processing' THEN 2
        WHEN 'pending' THEN 3
        WHEN 'completed' THEN 4
        ELSE 5
    END;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">5.4 Aggregate Functions</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Aggregate functions</strong> perform calculations on multiple rows and return a single 
                    summary value. They are used with GROUP BY for grouped aggregations.
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- COUNT (count number of rows)</span>
<span class="prompt">mysql></span> SELECT COUNT(*) AS total_employees FROM employees;
<span class="prompt">mysql></span> SELECT COUNT(phone) AS employees_with_phone FROM employees;
<span class="comment">-- COUNT(column) excludes NULL values</span>
<span class="prompt">mysql></span> SELECT COUNT(DISTINCT department_id) AS unique_departments FROM employees;

<span class="comment">-- SUM (add all values)</span>
<span class="prompt">mysql></span> SELECT SUM(salary) AS total_payroll FROM employees;
<span class="prompt">mysql></span> SELECT SUM(quantity * price) AS total_revenue FROM order_items;

<span class="comment">-- AVG (calculate average)</span>
<span class="prompt">mysql></span> SELECT AVG(salary) AS average_salary FROM employees;
<span class="prompt">mysql></span> SELECT AVG(price) AS avg_price FROM products WHERE category_id = 1;

<span class="comment">-- MAX (find maximum value)</span>
<span class="prompt">mysql></span> SELECT MAX(salary) AS highest_salary FROM employees;
<span class="prompt">mysql></span> SELECT MAX(order_date) AS most_recent_order FROM orders;

<span class="comment">-- MIN (find minimum value)</span>
<span class="prompt">mysql></span> SELECT MIN(salary) AS lowest_salary FROM employees;
<span class="prompt">mysql></span> SELECT MIN(price) AS cheapest_product FROM products;

<span class="comment">-- Multiple aggregates in one query</span>
<span class="prompt">mysql></span> SELECT 
    COUNT(*) AS total_orders,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS average_order_value,
    MIN(total_amount) AS smallest_order,
    MAX(total_amount) AS largest_order
FROM orders
WHERE order_date >= '2025-01-01';

<span class="comment">-- GROUP_CONCAT (MySQL-specific, concatenate values)</span>
<span class="prompt">mysql></span> SELECT 
    category_id,
    GROUP_CONCAT(product_name SEPARATOR ', ') AS products
FROM products
GROUP BY category_id;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">5.5 GROUP BY and HAVING</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- GROUP BY (group rows with same values)</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    COUNT(*) AS employee_count,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id;

<span class="comment">-- GROUP BY multiple columns</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    job_title,
    COUNT(*) AS count,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id, job_title;

<span class="comment">-- HAVING (filter AFTER aggregation)</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    AVG(salary) AS avg_salary
FROM employees
GROUP BY department_id
HAVING AVG(salary) > 60000;

<span class="comment">-- WHERE vs HAVING comparison</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    COUNT(*) AS employee_count
FROM employees
WHERE hire_date >= '2023-01-01'     <span class="comment">-- Filter BEFORE grouping</span>
GROUP BY department_id
HAVING COUNT(*) > 5;                <span class="comment">-- Filter AFTER grouping</span>

<span class="comment">-- Complex example with all clauses</span>
<span class="prompt">mysql></span> SELECT 
    category_id,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price,
    MIN(price) AS min_price,
    MAX(price) AS max_price,
    SUM(stock_quantity) AS total_stock
FROM products
WHERE is_active = TRUE                      <span class="comment">-- Filter rows first</span>
GROUP BY category_id                        <span class="comment">-- Group by category</span>
HAVING COUNT(*) >= 5 AND AVG(price) > 50   <span class="comment">-- Filter groups</span>
ORDER BY avg_price DESC                     <span class="comment">-- Sort results</span>
LIMIT 10;                                   <span class="comment">-- Limit output</span>
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: E-commerce Analytics Queries</h5>
                  <div class="sql-command">
<pre><span class="comment">-- 1. Top customers by total purchases</span>
SELECT 
    c.customer_id,
    CONCAT(c.first_name, ' ', c.last_name) AS customer_name,
    COUNT(o.order_id) AS total_orders,
    SUM(o.total_amount) AS total_spent,
    AVG(o.total_amount) AS avg_order_value
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
HAVING SUM(o.total_amount) > 1000
ORDER BY total_spent DESC
LIMIT 10;

<span class="comment">-- 2. Product sales performance by category</span>
SELECT 
    c.category_name,
    COUNT(DISTINCT p.product_id) AS total_products,
    SUM(oi.quantity) AS units_sold,
    SUM(oi.quantity * oi.unit_price) AS total_revenue,
    AVG(oi.unit_price) AS avg_selling_price
FROM categories c
JOIN products p ON c.category_id = p.category_id
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
WHERE o.status = 'delivered'
GROUP BY c.category_id, c.category_name
ORDER BY total_revenue DESC;

<span class="comment">-- 3. Monthly sales trend</span>
SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    DATE_FORMAT(order_date, '%Y-%m') AS year_month,
    COUNT(*) AS order_count,
    SUM(total_amount) AS monthly_revenue,
    AVG(total_amount) AS avg_order_value
FROM orders
WHERE order_date >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
GROUP BY YEAR(order_date), MONTH(order_date)
ORDER BY year, month;

<span class="comment">-- 4. Products needing restock</span>
SELECT 
    p.product_name,
    p.stock_quantity,
    COUNT(oi.order_item_id) AS times_ordered,
    SUM(oi.quantity) AS total_sold,
    AVG(oi.quantity) AS avg_per_order
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.product_name, p.stock_quantity
HAVING p.stock_quantity < 10 OR SUM(oi.quantity) > p.stock_quantity * 0.8
ORDER BY stock_quantity ASC;
</pre>
                  </div>
                </div>
              </div>
                            <div class="section">
                <h3 class="section-title">5.6 Subqueries (Nested Queries)</h3>
                
                <div class="definition-box">
                  <p>
                    A <strong>subquery</strong> is a query nested inside another query. The inner query executes first 
                    and passes its result to the outer query. Subqueries can appear in SELECT, FROM, WHERE clauses.
                  </p>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Subquery Locations and Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Location</th>
                        <th>Result Type</th>
                        <th>Purpose</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>SELECT Clause</strong></td>
                        <td>Scalar (single value)</td>
                        <td>Returns a single aggregated value for each row</td>
                      </tr>
                      <tr>
                        <td><strong>FROM Clause</strong></td>
                        <td>Table (multiple rows & columns)</td>
                        <td>Creates temporary result set (requires alias)</td>
                      </tr>
                      <tr>
                        <td><strong>WHERE Clause</strong></td>
                        <td>Scalar or Column (multiple rows)</td>
                        <td>Filters data dynamically with IN, EXISTS, ANY, ALL</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Scalar subquery in WHERE (single value)</span>
<span class="prompt">mysql></span> SELECT first_name, last_name, salary
FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
<span class="comment">-- Find employees earning above average</span>

<span class="comment">-- Subquery with IN (multiple values)</span>
<span class="prompt">mysql></span> SELECT product_name, price
FROM products
WHERE category_id IN (
    SELECT category_id 
    FROM categories 
    WHERE category_name IN ('Electronics', 'Computers')
);

<span class="comment">-- Subquery in SELECT clause</span>
<span class="prompt">mysql></span> SELECT 
    e.first_name,
    e.salary,
    (SELECT AVG(salary) FROM employees) AS company_avg,
    e.salary - (SELECT AVG(salary) FROM employees) AS difference
FROM employees e;

<span class="comment">-- Subquery in FROM clause (derived table)</span>
<span class="prompt">mysql></span> SELECT dept_id, avg_salary
FROM (
    SELECT 
        department_id AS dept_id,
        AVG(salary) AS avg_salary
    FROM employees
    GROUP BY department_id
) AS dept_averages
WHERE avg_salary > 60000;

<span class="comment">-- Correlated subquery (references outer query)</span>
<span class="prompt">mysql></span> SELECT e1.first_name, e1.last_name, e1.salary
FROM employees e1
WHERE salary > (
    SELECT AVG(salary)
    FROM employees e2
    WHERE e2.department_id = e1.department_id
);
<span class="comment">-- Employees earning above their department average</span>

<span class="comment">-- EXISTS (checks if subquery returns any rows)</span>
<span class="prompt">mysql></span> SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id 
      AND o.order_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
);
<span class="comment">-- Customers with orders in last 30 days</span>

<span class="comment">-- NOT EXISTS</span>
<span class="prompt">mysql></span> SELECT c.customer_id, c.first_name, c.last_name
FROM customers c
WHERE NOT EXISTS (
    SELECT 1 
    FROM orders o 
    WHERE o.customer_id = c.customer_id
);
<span class="comment">-- Customers with no orders</span>

<span class="comment">-- ANY/SOME (value must match at least one value)</span>
<span class="prompt">mysql></span> SELECT product_name, price
FROM products
WHERE price > ANY (
    SELECT price 
    FROM products 
    WHERE category_id = 1
);
<span class="comment">-- Products more expensive than ANY product in category 1</span>

<span class="comment">-- ALL (value must match all values)</span>
<span class="prompt">mysql></span> SELECT product_name, price
FROM products
WHERE price > ALL (
    SELECT price 
    FROM products 
    WHERE category_id = 1
);
<span class="comment">-- Products more expensive than ALL products in category 1</span>

<span class="comment">-- Multiple subqueries</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    price,
    (SELECT AVG(price) FROM products) AS avg_price,
    (SELECT MAX(price) FROM products) AS max_price,
    price / (SELECT AVG(price) FROM products) * 100 AS price_index
FROM products
WHERE category_id = (
    SELECT category_id 
    FROM categories 
    WHERE category_name = 'Electronics'
);
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">5.7 Common Table Expressions (CTE)</h3>
                
                <div class="definition-box">
                  <p>
                    A <strong>CTE (Common Table Expression)</strong> is a temporary named result set defined with 
                    WITH...AS syntax. CTEs improve readability, modularity, and can be referenced multiple times 
                    in a single query.
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Basic CTE</span>
<span class="prompt">mysql></span> WITH high_earners AS (
    SELECT first_name, last_name, salary, department_id
    FROM employees
    WHERE salary > 70000
)
SELECT * FROM high_earners
ORDER BY salary DESC;

<span class="comment">-- Multiple CTEs</span>
<span class="prompt">mysql></span> WITH 
    dept_avg AS (
        SELECT department_id, AVG(salary) AS avg_salary
        FROM employees
        GROUP BY department_id
    ),
    high_earners AS (
        SELECT e.*, d.avg_salary
        FROM employees e
        JOIN dept_avg d ON e.department_id = d.department_id
        WHERE e.salary > d.avg_salary
    )
SELECT 
    department_id,
    COUNT(*) AS high_earner_count,
    AVG(salary) AS avg_high_earner_salary
FROM high_earners
GROUP BY department_id;

<span class="comment">-- Nested CTE (one CTE uses another)</span>
<span class="prompt">mysql></span> WITH 
    sales_summary AS (
        SELECT 
            product_id,
            SUM(quantity) AS total_sold,
            SUM(quantity * unit_price) AS revenue
        FROM order_items
        GROUP BY product_id
    ),
    top_products AS (
        SELECT 
            p.product_name,
            s.total_sold,
            s.revenue,
            RANK() OVER (ORDER BY s.revenue DESC) AS revenue_rank
        FROM products p
        JOIN sales_summary s ON p.product_id = s.product_id
    )
SELECT * FROM top_products
WHERE revenue_rank <= 10;

<span class="comment">-- Recursive CTE (for hierarchical data)</span>
<span class="prompt">mysql></span> WITH RECURSIVE employee_hierarchy AS (
    <span class="comment">-- Anchor: Start with top-level employees (no manager)</span>
    SELECT 
        employee_id,
        first_name,
        last_name,
        manager_id,
        1 AS level,
        CAST(first_name AS CHAR(200)) AS path
    FROM employees
    WHERE manager_id IS NULL
    
    UNION ALL
    
    <span class="comment">-- Recursive: Get employees reporting to current level</span>
    SELECT 
        e.employee_id,
        e.first_name,
        e.last_name,
        e.manager_id,
        eh.level + 1,
        CONCAT(eh.path, ' > ', e.first_name)
    FROM employees e
    JOIN employee_hierarchy eh ON e.manager_id = eh.employee_id
)
SELECT * FROM employee_hierarchy
ORDER BY level, first_name;

<span class="comment">-- CTE for complex reporting</span>
<span class="prompt">mysql></span> WITH 
    monthly_sales AS (
        SELECT 
            DATE_FORMAT(order_date, '%Y-%m') AS month,
            SUM(total_amount) AS revenue
        FROM orders
        WHERE order_date >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
        GROUP BY DATE_FORMAT(order_date, '%Y-%m')
    ),
    monthly_growth AS (
        SELECT 
            month,
            revenue,
            LAG(revenue) OVER (ORDER BY month) AS prev_month_revenue,
            revenue - LAG(revenue) OVER (ORDER BY month) AS growth_amount,
            ROUND((revenue - LAG(revenue) OVER (ORDER BY month)) / 
                  LAG(revenue) OVER (ORDER BY month) * 100, 2) AS growth_percentage
        FROM monthly_sales
    )
SELECT * FROM monthly_growth
ORDER BY month DESC;
</pre>
                </div>

                <div class="comparison-table">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>CTE</th>
                      <th>Subquery</th>
                      <th>View</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Scope</strong></td>
                      <td>Single query execution</td>
                      <td>Single location in query</td>
                      <td>Permanent (database level)</td>
                    </tr>
                    <tr>
                      <td><strong>Reusability</strong></td>
                      <td>Multiple times in same query</td>
                      <td>Must repeat code</td>
                      <td>Across multiple queries</td>
                    </tr>
                    <tr>
                      <td><strong>Readability</strong></td>
                      <td>✅ High (named, organized)</td>
                      <td>⚠️ Medium (can be nested)</td>
                      <td>✅ High</td>
                    </tr>
                    <tr>
                      <td><strong>Recursion</strong></td>
                      <td>✅ Yes (WITH RECURSIVE)</td>
                      <td>❌ No</td>
                      <td>❌ No</td>
                    </tr>
                    <tr>
                      <td><strong>Storage</strong></td>
                      <td>❌ Temporary (query only)</td>
                      <td>❌ Temporary (query only)</td>
                      <td>✅ Persistent</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">5.8 SQL Functions</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">String Functions</h4>
                  <div class="sql-command">
<pre><span class="comment">-- CONCAT (combine strings)</span>
<span class="prompt">mysql></span> SELECT CONCAT(first_name, ' ', last_name) AS full_name FROM employees;
<span class="prompt">mysql></span> SELECT CONCAT_WS(', ', last_name, first_name) AS name FROM employees;

<span class="comment">-- UPPER, LOWER (change case)</span>
<span class="prompt">mysql></span> SELECT UPPER(product_name) FROM products;
<span class="prompt">mysql></span> SELECT LOWER(email) FROM customers;

<span class="comment">-- TRIM, LTRIM, RTRIM (remove spaces)</span>
<span class="prompt">mysql></span> SELECT TRIM('  hello  ') AS trimmed;
<span class="prompt">mysql></span> SELECT LTRIM('  hello') AS left_trimmed;
<span class="prompt">mysql></span> SELECT RTRIM('hello  ') AS right_trimmed;

<span class="comment">-- LENGTH (character count)</span>
<span class="prompt">mysql></span> SELECT product_name, LENGTH(product_name) AS name_length FROM products;

<span class="comment">-- SUBSTRING (extract part of string)</span>
<span class="prompt">mysql></span> SELECT SUBSTRING('Hello World', 1, 5);  <span class="comment">-- 'Hello'</span>
<span class="prompt">mysql></span> SELECT SUBSTRING(email, 1, LOCATE('@', email) - 1) AS username FROM customers;

<span class="comment">-- LEFT, RIGHT (extract from start/end)</span>
<span class="prompt">mysql></span> SELECT LEFT('Hello World', 5);   <span class="comment">-- 'Hello'</span>
<span class="prompt">mysql></span> SELECT RIGHT('Hello World', 5);  <span class="comment">-- 'World'</span>

<span class="comment">-- REPLACE (replace characters)</span>
<span class="prompt">mysql></span> SELECT REPLACE(phone, '-', '') AS phone_clean FROM customers;

<span class="comment">-- LOCATE, POSITION (find substring position)</span>
<span class="prompt">mysql></span> SELECT LOCATE('@', email) AS at_position FROM customers;

<span class="comment">-- REVERSE (reverse string)</span>
<span class="prompt">mysql></span> SELECT REVERSE('Hello');  <span class="comment">-- 'olleH'</span>

<span class="comment">-- REPEAT (repeat string)</span>
<span class="prompt">mysql></span> SELECT REPEAT('*', 5);  <span class="comment">-- '*****'</span>
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Numeric Functions</h4>
                  <div class="sql-command">
<pre><span class="comment">-- ROUND (round number)</span>
<span class="prompt">mysql></span> SELECT ROUND(3.14159, 2);  <span class="comment">-- 3.14</span>
<span class="prompt">mysql></span> SELECT ROUND(price, 2) FROM products;

<span class="comment">-- CEIL, FLOOR (round up/down)</span>
<span class="prompt">mysql></span> SELECT CEIL(3.14);   <span class="comment">-- 4</span>
<span class="prompt">mysql></span> SELECT FLOOR(3.99);  <span class="comment">-- 3</span>

<span class="comment">-- ABS (absolute value)</span>
<span class="prompt">mysql></span> SELECT ABS(-42);  <span class="comment">-- 42</span>

<span class="comment">-- MOD (modulo - remainder)</span>
<span class="prompt">mysql></span> SELECT MOD(10, 3);  <span class="comment">-- 1</span>

<span class="comment">-- POWER (exponentiation)</span>
<span class="prompt">mysql></span> SELECT POWER(2, 3);  <span class="comment">-- 8</span>

<span class="comment">-- SQRT (square root)</span>
<span class="prompt">mysql></span> SELECT SQRT(16);  <span class="comment">-- 4</span>

<span class="comment">-- RAND (random number 0-1)</span>
<span class="prompt">mysql></span> SELECT RAND();
<span class="prompt">mysql></span> SELECT FLOOR(RAND() * 100) AS random_0_to_99;

<span class="comment">-- TRUNCATE (truncate decimals)</span>
<span class="prompt">mysql></span> SELECT TRUNCATE(3.14159, 2);  <span class="comment">-- 3.14</span>
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Date & Time Functions</h4>
                  <div class="sql-command">
<pre><span class="comment">-- Current date/time</span>
<span class="prompt">mysql></span> SELECT CURDATE();      <span class="comment">-- Current date</span>
<span class="prompt">mysql></span> SELECT CURTIME();      <span class="comment">-- Current time</span>
<span class="prompt">mysql></span> SELECT NOW();          <span class="comment">-- Current datetime</span>
<span class="prompt">mysql></span> SELECT CURRENT_TIMESTAMP();

<span class="comment">-- Extract parts (returns integer)</span>
<span class="prompt">mysql></span> SELECT YEAR(order_date) FROM orders;
<span class="prompt">mysql></span> SELECT MONTH(order_date) FROM orders;
<span class="prompt">mysql></span> SELECT DAY(order_date) FROM orders;
<span class="prompt">mysql></span> SELECT HOUR(created_at) FROM logs;
<span class="prompt">mysql></span> SELECT MINUTE(created_at) FROM logs;
<span class="prompt">mysql></span> SELECT SECOND(created_at) FROM logs;

<span class="comment">-- DAYNAME, MONTHNAME (returns string)</span>
<span class="prompt">mysql></span> SELECT DAYNAME(order_date) FROM orders;      <span class="comment">-- 'Monday'</span>
<span class="prompt">mysql></span> SELECT MONTHNAME(order_date) FROM orders;    <span class="comment">-- 'January'</span>

<span class="comment">-- DAYOFWEEK, DAYOFYEAR</span>
<span class="prompt">mysql></span> SELECT DAYOFWEEK(order_date) FROM orders;    <span class="comment">-- 1=Sunday, 7=Saturday</span>
<span class="prompt">mysql></span> SELECT DAYOFYEAR(order_date) FROM orders;    <span class="comment">-- 1-366</span>

<span class="comment">-- WEEK, QUARTER</span>
<span class="prompt">mysql></span> SELECT WEEK(order_date) FROM orders;
<span class="prompt">mysql></span> SELECT QUARTER(order_date) FROM orders;

<span class="comment">-- DATE_FORMAT (format date as string)</span>
<span class="prompt">mysql></span> SELECT DATE_FORMAT(order_date, '%Y-%m-%d') FROM orders;
<span class="prompt">mysql></span> SELECT DATE_FORMAT(order_date, '%d/%m/%Y') FROM orders;
<span class="prompt">mysql></span> SELECT DATE_FORMAT(order_date, '%M %d, %Y') FROM orders;  <span class="comment">-- January 15, 2025</span>
<span class="prompt">mysql></span> SELECT DATE_FORMAT(NOW(), '%W, %M %d, %Y %H:%i:%s');

<span class="comment">-- STR_TO_DATE (string to date)</span>
<span class="prompt">mysql></span> SELECT STR_TO_DATE('01/15/2025', '%m/%d/%Y');

<span class="comment">-- DATE_ADD, DATE_SUB (add/subtract interval)</span>
<span class="prompt">mysql></span> SELECT DATE_ADD(CURDATE(), INTERVAL 7 DAY);
<span class="prompt">mysql></span> SELECT DATE_SUB(CURDATE(), INTERVAL 1 MONTH);
<span class="prompt">mysql></span> SELECT DATE_ADD(NOW(), INTERVAL 2 HOUR);

<span class="comment">-- DATEDIFF (difference in days)</span>
<span class="prompt">mysql></span> SELECT DATEDIFF(CURDATE(), hire_date) AS days_employed FROM employees;

<span class="comment">-- TIMESTAMPDIFF (difference in any unit)</span>
<span class="prompt">mysql></span> SELECT TIMESTAMPDIFF(YEAR, hire_date, CURDATE()) AS years_employed FROM employees;
<span class="prompt">mysql></span> SELECT TIMESTAMPDIFF(MONTH, hire_date, CURDATE()) AS months_employed FROM employees;

<span class="comment">-- LAST_DAY (last day of month)</span>
<span class="prompt">mysql></span> SELECT LAST_DAY('2025-02-15');  <span class="comment">-- 2025-02-28</span>

<span class="comment">-- Practical examples</span>
<span class="prompt">mysql></span> SELECT 
    order_id,
    order_date,
    DATE_FORMAT(order_date, '%W') AS day_of_week,
    DATEDIFF(CURDATE(), order_date) AS days_ago,
    CASE 
        WHEN DATEDIFF(CURDATE(), order_date) < 7 THEN 'This Week'
        WHEN DATEDIFF(CURDATE(), order_date) < 30 THEN 'This Month'
        ELSE 'Older'
    END AS order_age
FROM orders;
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">CASE Statement</h4>
                  <div class="sql-command">
<pre><span class="comment">-- Simple CASE (equality comparison)</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    CASE category_id
        WHEN 1 THEN 'Electronics'
        WHEN 2 THEN 'Clothing'
        WHEN 3 THEN 'Books'
        ELSE 'Other'
    END AS category_name
FROM products;

<span class="comment">-- Searched CASE (complex conditions)</span>
<span class="prompt">mysql></span> SELECT 
    first_name,
    last_name,
    salary,
    CASE 
        WHEN salary < 40000 THEN 'Entry Level'
        WHEN salary BETWEEN 40000 AND 70000 THEN 'Mid Level'
        WHEN salary BETWEEN 70000 AND 100000 THEN 'Senior Level'
        ELSE 'Executive Level'
    END AS salary_grade
FROM employees;

<span class="comment">-- CASE with aggregation</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN salary > 60000 THEN 1 ELSE 0 END) AS high_earners,
    SUM(CASE WHEN salary <= 60000 THEN 1 ELSE 0 END) AS regular_earners,
    AVG(CASE WHEN gender = 'M' THEN salary END) AS avg_male_salary,
    AVG(CASE WHEN gender = 'F' THEN salary END) AS avg_female_salary
FROM employees
GROUP BY department_id;

<span class="comment">-- CASE in ORDER BY</span>
<span class="prompt">mysql></span> SELECT * FROM orders
ORDER BY 
    CASE status
        WHEN 'urgent' THEN 1
        WHEN 'processing' THEN 2
        WHEN 'pending' THEN 3
        ELSE 4
    END;

<span class="comment">-- Complex business logic example</span>
<span class="prompt">mysql></span> SELECT 
    product_name,
    stock_quantity,
    CASE 
        WHEN stock_quantity = 0 THEN 'Out of Stock'
        WHEN stock_quantity < 10 THEN 'Low Stock - Order Soon'
        WHEN stock_quantity < 50 THEN 'Normal Stock'
        ELSE 'Well Stocked'
    END AS stock_status,
    CASE 
        WHEN stock_quantity = 0 THEN 'red'
        WHEN stock_quantity < 10 THEN 'orange'
        WHEN stock_quantity < 50 THEN 'yellow'
        ELSE 'green'
    END AS alert_color
FROM products;
</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div id="lesson6" class="lesson">
            <div class="lesson-header">
              <h2>Module 6: Joins & Relationships</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">6.1 Understanding Joins</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Joins</strong> combine rows from two or more tables based on a related column between them. 
                    They are essential for retrieving data from normalized databases.
                  </p>
                </div>

                <div class="code-box">
<pre style = "text-align:center;">
<strong>Join Visualization:</strong>

Table A (Employees)          Table B (Departments)
┌────┬──────┬────────┐        ┌────┬──────────────┐
│ ID │ Name │ Dept_ID│        │ ID │ Department   │
├────┼──────┼────────┤        ├────┼──────────────┤
│ 1  │ John │   101  │───┐    │ 101│ Sales        │
│ 2  │ Jane │   102  │   │    │ 102│ Marketing    │
│ 3  │ Bob  │   101  │───┼───>│ 103│ Engineering  │
│ 4  │ Sue  │   104  │   │    └────┴──────────────┘
└────┴──────┴────────┘   │
         ↓               │
    (No match for        │
     Dept 104)           └── (Common Column: Dept_ID = ID)
</pre>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Join Types Comparison</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Join Type</th>
                        <th>Returns</th>
                        <th>Use Case</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>INNER JOIN</strong></td>
                        <td>Only matching rows from both tables</td>
                        <td>Most common - get related data that exists in both tables</td>
                      </tr>
                      <tr>
                        <td><strong>LEFT JOIN</strong><br>(LEFT OUTER JOIN)</td>
                        <td>All rows from left table + matching from right</td>
                        <td>Get all records from main table, even without matches</td>
                      </tr>
                      <tr>
                        <td><strong>RIGHT JOIN</strong><br>(RIGHT OUTER JOIN)</td>
                        <td>All rows from right table + matching from left</td>
                        <td>Less common - opposite of LEFT JOIN</td>
                      </tr>
                      <tr>
                        <td><strong>FULL OUTER JOIN</strong></td>
                        <td>All rows from both tables (with NULLs for non-matches)</td>
                        <td>Get everything from both tables (MySQL: use UNION)</td>
                      </tr>
                      <tr>
                        <td><strong>CROSS JOIN</strong></td>
                        <td>Cartesian product (every row with every row)</td>
                        <td>Generate combinations, rarely used</td>
                      </tr>
                      <tr>
                        <td><strong>SELF JOIN</strong></td>
                        <td>Table joined with itself</td>
                        <td>Hierarchical data, compare rows within same table</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.2 INNER JOIN</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Basic INNER JOIN</span>
<span class="prompt">mysql></span> SELECT 
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.department_id;

<span class="comment">-- INNER JOIN with WHERE</span>
<span class="prompt">mysql></span> SELECT 
    e.first_name,
    e.last_name,
    d.department_name,
    e.salary
FROM employees e
INNER JOIN departments d ON e.department_id = d.department_id
WHERE e.salary > 60000;

<span class="comment">-- Multiple INNER JOINs</span>
<span class="prompt">mysql></span> SELECT 
    o.order_id,
    c.first_name,
    c.last_name,
    p.product_name,
    oi.quantity,
    oi.unit_price
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= '2025-01-01';

<span class="comment">-- INNER JOIN with GROUP BY</span>
<span class="prompt">mysql></span> SELECT 
    d.department_name,
    COUNT(e.employee_id) AS employee_count,
    AVG(e.salary) AS avg_salary,
    MAX(e.salary) AS max_salary
FROM departments d
INNER JOIN employees e ON d.department_id = e.department_id
GROUP BY d.department_id, d.department_name
HAVING COUNT(e.employee_id) > 5;

<span class="comment">-- INNER JOIN with multiple conditions</span>
<span class="prompt">mysql></span> SELECT 
    e.first_name,
    e.last_name,
    j.job_title,
    jh.start_date,
    jh.end_date
FROM employees e
INNER JOIN job_history jh 
    ON e.employee_id = jh.employee_id 
    AND jh.end_date IS NULL  <span class="comment">-- Current job only</span>
INNER JOIN jobs j ON jh.job_id = j.job_id;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.3 LEFT JOIN (LEFT OUTER JOIN)</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Basic LEFT JOIN</span>
<span class="prompt">mysql></span> SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    o.order_id,
    o.order_date
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id;
<span class="comment">-- Returns ALL customers, even those without orders (NULL for order columns)</span>

<span class="comment">-- Find customers without orders (NULL check)</span>
<span class="prompt">mysql></span> SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    c.email
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE o.order_id IS NULL;
<span class="comment">-- Only customers with no orders</span>

<span class="comment">-- LEFT JOIN with COUNT</span>
<span class="prompt">mysql></span> SELECT 
    c.customer_id,
    c.first_name,
    c.last_name,
    COUNT(o.order_id) AS order_count,
    COALESCE(SUM(o.total_amount), 0) AS total_spent
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name
ORDER BY order_count DESC;

<span class="comment">-- Multiple LEFT JOINs</span>
<span class="prompt">mysql></span> SELECT 
    p.product_name,
    p.stock_quantity,
    c.category_name,
    COUNT(oi.order_item_id) AS times_ordered,
    COALESCE(SUM(oi.quantity), 0) AS total_sold
FROM products p
LEFT JOIN categories c ON p.category_id = c.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
GROUP BY p.product_id, p.product_name, p.stock_quantity, c.category_name;
<span class="comment">-- Shows all products, even never ordered</span>

<span class="comment">-- LEFT JOIN to find orphaned records</span>
<span class="prompt">mysql></span> SELECT 
    e.employee_id,
    e.first_name,
    e.last_name,
    e.department_id
FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id
WHERE d.department_id IS NULL;
<span class="comment">-- Employees assigned to non-existent departments</span>
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.4 RIGHT JOIN and FULL OUTER JOIN</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- RIGHT JOIN (opposite of LEFT JOIN)</span>
<span class="prompt">mysql></span> SELECT 
    o.order_id,
    o.order_date,
    c.first_name,
    c.last_name
FROM orders o
RIGHT JOIN customers c ON o.customer_id = c.customer_id;
<span class="comment">-- Returns ALL customers (right table), even without orders</span>

<span class="comment">-- Convert RIGHT JOIN to LEFT JOIN (more readable)</span>
<span class="prompt">mysql></span> SELECT 
    o.order_id,
    o.order_date,
    c.first_name,
    c.last_name
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id;
<span class="comment">-- Same result, but LEFT JOIN is preferred for readability</span>

<span class="comment">-- FULL OUTER JOIN (MySQL doesn't support directly - use UNION)</span>
<span class="prompt">mysql></span> SELECT 
    e.employee_id,
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id

UNION

SELECT 
    e.employee_id,
    e.first_name,
    e.last_name,
    d.department_name
FROM employees e
RIGHT JOIN departments d ON e.department_id = d.department_id;
<span class="comment">-- Returns ALL employees AND ALL departments (with NULLs where no match)</span>
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.5 CROSS JOIN</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- CROSS JOIN (Cartesian product - every combination)</span>
<span class="prompt">mysql></span> SELECT 
    c.color,
    s.size
FROM colors c
CROSS JOIN sizes s;
<span class="comment">-- If colors has 3 rows and sizes has 4 rows, result has 12 rows</span>

<span class="comment">-- Practical example: Generate all time slots</span>
<span class="prompt">mysql></span> SELECT 
    d.date,
    t.time_slot
FROM dates d
CROSS JOIN time_slots t
WHERE d.date BETWEEN '2025-10-20' AND '2025-10-27';

<span class="comment">-- Generate number sequence using CROSS JOIN</span>
<span class="prompt">mysql></span> SELECT 
    (a.num * 10 + b.num) AS number
FROM 
    (SELECT 0 AS num UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
     UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) a
CROSS JOIN
    (SELECT 0 AS num UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
     UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) b
ORDER BY number;
<span class="comment">-- Generates numbers 0-99</span>
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.6 SELF JOIN</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- SELF JOIN (table joined with itself)</span>
<span class="comment">-- Example: Employee hierarchy (employees with managers)</span>
<span class="prompt">mysql></span> SELECT 
    e.employee_id,
    e.first_name AS employee_name,
    e.manager_id,
    m.first_name AS manager_name
FROM employees e
LEFT JOIN employees m ON e.manager_id = m.employee_id;
<span class="comment">-- e = employee, m = manager (same table, different aliases)</span>

<span class="comment">-- Find employees in same department</span>
<span class="prompt">mysql></span> SELECT 
    e1.first_name AS employee1,
    e2.first_name AS employee2,
    e1.department_id
FROM employees e1
JOIN employees e2 
    ON e1.department_id = e2.department_id 
    AND e1.employee_id < e2.employee_id
ORDER BY e1.department_id;
<span class="comment">-- Shows unique pairs of colleagues</span>

<span class="comment">-- Find products in same price range</span>
<span class="prompt">mysql></span> SELECT 
    p1.product_name AS product1,
    p2.product_name AS product2,
    p1.price
FROM products p1
JOIN products p2 
    ON ABS(p1.price - p2.price) < 10 
    AND p1.product_id < p2.product_id
ORDER BY p1.price;

<span class="comment">-- Hierarchical query with levels</span>
<span class="prompt">mysql></span> SELECT 
    e1.first_name AS employee,
    e2.first_name AS manager,
    e3.first_name AS manager_manager
FROM employees e1
LEFT JOIN employees e2 ON e1.manager_id = e2.employee_id
LEFT JOIN employees e3 ON e2.manager_id = e3.employee_id;
<span class="comment">-- Shows 3 levels of hierarchy</span>
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">6.7 UNION, UNION ALL, INTERSECT, EXCEPT</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- UNION (combines results, removes duplicates)</span>
<span class="prompt">mysql></span> SELECT first_name, last_name FROM employees
UNION
SELECT first_name, last_name FROM customers;
<span class="comment">-- Combines both lists, removes duplicate names</span>

<span class="comment">-- UNION ALL (combines results, keeps duplicates - faster)</span>
<span class="prompt">mysql></span> SELECT first_name, last_name FROM employees
UNION ALL
SELECT first_name, last_name FROM customers;
<span class="comment">-- Keeps all rows, including duplicates</span>

<span class="comment">-- UNION with ORDER BY (applies to entire result)</span>
<span class="prompt">mysql></span> SELECT product_name, price, 'In Stock' AS status
FROM products WHERE stock_quantity > 0
UNION
SELECT product_name, price, 'Out of Stock' AS status
FROM products WHERE stock_quantity = 0
ORDER BY price DESC;

<span class="comment">-- Combine data from different time periods</span>
<span class="prompt">mysql></span> SELECT 'This Month' AS period, SUM(total_amount) AS revenue
FROM orders WHERE MONTH(order_date) = MONTH(CURDATE())
UNION ALL
SELECT 'Last Month', SUM(total_amount)
FROM orders WHERE MONTH(order_date) = MONTH(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))
UNION ALL
SELECT 'This Year', SUM(total_amount)
FROM orders WHERE YEAR(order_date) = YEAR(CURDATE());

<span class="comment">-- INTERSECT (MySQL 8.0.31+) - rows in both queries</span>
<span class="prompt">mysql></span> SELECT product_id FROM products WHERE category_id = 1
INTERSECT
SELECT product_id FROM order_items;
<span class="comment">-- Products in category 1 that have been ordered</span>

<span class="comment">-- EXCEPT / MINUS - rows in first query but not in second</span>
<span class="prompt">mysql></span> SELECT product_id FROM products
EXCEPT
SELECT product_id FROM order_items;
<span class="comment">-- Products that have never been ordered</span>

<span class="comment">-- Simulate INTERSECT in older MySQL (using INNER JOIN)</span>
<span class="prompt">mysql></span> SELECT DISTINCT p.product_id
FROM products p
INNER JOIN order_items oi ON p.product_id = oi.product_id
WHERE p.category_id = 1;

<span class="comment">-- Simulate EXCEPT in older MySQL (using LEFT JOIN)</span>
<span class="prompt">mysql></span> SELECT p.product_id
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id
WHERE oi.product_id IS NULL;
</pre>
                </div>

                <div class="comparison-table">
                  <thead>
                    <tr>
                      <th>Operator</th>
                      <th>Purpose</th>
                      <th>Duplicates</th>
                      <th>Requirements</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>UNION</strong></td>
                      <td>Combine results, remove duplicates</td>
                      <td>❌ Removed</td>
                      <td>Same number and type of columns</td>
                    </tr>
                    <tr>
                      <td><strong>UNION ALL</strong></td>
                      <td>Combine results, keep duplicates</td>
                      <td>✅ Kept (faster)</td>
                      <td>Same number and type of columns</td>
                    </tr>
                    <tr>
                      <td><strong>INTERSECT</strong></td>
                      <td>Rows in both queries</td>
                      <td>❌ Removed</td>
                      <td>MySQL 8.0.31+ only</td>
                    </tr>
                    <tr>
                      <td><strong>EXCEPT</strong></td>
                      <td>Rows in first but not second</td>
                      <td>❌ Removed</td>
                      <td>MySQL 8.0.31+ only</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">6.8 Complex Join Examples</h3>
                
                <div class="example-box">
                  <h5>Example 1: E-commerce Order Details</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Complete order information with customer, products, and category</span>
SELECT 
    o.order_id,
    o.order_date,
    CONCAT(c.first_name, ' ', c.last_name) AS customer_name,
    c.email,
    c.city,
    p.product_name,
    cat.category_name,
    oi.quantity,
    oi.unit_price,
    oi.quantity * oi.unit_price AS item_total,
    o.status
FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.product_id
INNER JOIN categories cat ON p.category_id = cat.category_id
WHERE o.order_date >= '2025-01-01'
ORDER BY o.order_id, oi.order_item_id;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Example 2: Customer Lifetime Value Report</h5>
                  <div class="sql-command">
<pre>SELECT 
    c.customer_id,
    CONCAT(c.first_name, ' ', c.last_name) AS customer_name,
    c.email,
    c.city,
    c.state,
    COUNT(DISTINCT o.order_id) AS total_orders,
    COUNT(DISTINCT oi.product_id) AS unique_products_bought,
    SUM(oi.quantity) AS total_items,
    SUM(oi.quantity * oi.unit_price) AS total_spent,
    AVG(o.total_amount) AS avg_order_value,
    MIN(o.order_date) AS first_order,
    MAX(o.order_date) AS last_order,
    DATEDIFF(CURDATE(), MAX(o.order_date)) AS days_since_last_order,
    CASE 
        WHEN SUM(oi.quantity * oi.unit_price) > 10000 THEN 'Platinum'
        WHEN SUM(oi.quantity * oi.unit_price) > 5000 THEN 'Gold'
        WHEN SUM(oi.quantity * oi.unit_price) > 1000 THEN 'Silver'
        ELSE 'Bronze'
    END AS customer_tier
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id AND o.status = 'delivered'
LEFT JOIN order_items oi ON o.order_id = oi.order_id
GROUP BY c.customer_id, c.first_name, c.last_name, c.email, c.city, c.state
ORDER BY total_spent DESC;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Example 3: Product Performance with Ratings</h5>
                  <div class="sql-command">
<pre>SELECT 
    p.product_id,
    p.product_name,
    cat.category_name,
    p.price,
    p.stock_quantity,
    COUNT(DISTINCT oi.order_id) AS times_ordered,
    COALESCE(SUM(oi.quantity), 0) AS total_sold,
    COALESCE(SUM(oi.quantity * oi.unit_price), 0) AS total_revenue,
    COUNT(r.review_id) AS review_count,
    COALESCE(AVG(r.rating), 0) AS avg_rating,
    CASE 
        WHEN COUNT(DISTINCT oi.order_id) = 0 THEN 'Never Ordered'
        WHEN COALESCE(SUM(oi.quantity), 0) < 10 THEN 'Low Sales'
        WHEN COALESCE(SUM(oi.quantity), 0) < 50 THEN 'Medium Sales'
        ELSE 'High Sales'
    END AS sales_category
FROM products p
INNER JOIN categories cat ON p.category_id = cat.category_id
LEFT JOIN order_items oi ON p.product_id = oi.product_id
LEFT JOIN reviews r ON p.product_id = r.product_id
GROUP BY p.product_id, p.product_name, cat.category_name, p.price, p.stock_quantity
ORDER BY total_revenue DESC;
</pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
                  <div id="lesson7" class="lesson">
            <div class="lesson-header">
              <h2>Module 7: Indexes & Performance Optimization</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">7.1 Understanding Indexes</h3>
                
                <div class="definition-box">
                  <p>
                    An <strong>Index</strong> is a data structure that provides quick access to rows in a table, 
                    similar to an index in a book. Indexes dramatically improve query performance but add overhead 
                    to INSERT, UPDATE, and DELETE operations.
                  </p>
                </div>

                <div class="highlight-box">
                  <p><strong>Index Benefits:</strong></p>
                  <ul>
                    <li>⚡ <strong>Faster Queries:</strong> Can be 100x-1000x faster for large tables</li>
                    <li>🔍 <strong>Efficient Searching:</strong> Quickly locates rows without full table scan</li>
                    <li>📊 <strong>Better Sorting:</strong> ORDER BY operations are faster</li>
                    <li>🔗 <strong>JOIN Optimization:</strong> Speeds up JOIN operations</li>
                    <li>✅ <strong>Uniqueness:</strong> Enforces unique constraints</li>
                  </ul>
                </div>

                <div class="warning-box">
                  <strong>Index Costs:</strong>
                  <ul>
                    <li>💾 Additional disk space required</li>
                    <li>⏱️ Slower INSERT, UPDATE, DELETE (index must be updated)</li>
                    <li>🔄 Maintenance overhead</li>
                    <li>⚠️ Too many indexes can hurt overall performance</li>
                  </ul>
                </div>

                <div class="code-box">
<pre style = "text-align:center;">
<strong>B-Tree Index Structure (Most Common):</strong>

                    Root Node
                   ┌──────────┐
                   │ 50 | 100 │
                   └─┬─────┬──┘
           ┌─────────┘     └─────────┐
           ▼                          ▼
    ┌──────────┐              ┌──────────┐
    │ 25 | 40  │              │ 75 | 90  │
    └─┬────┬───┘              └─┬────┬───┘
  ┌───┘    └───┐          ┌───┘    └───┐
  ▼            ▼          ▼            ▼
Leaf         Leaf       Leaf         Leaf
Nodes        Nodes      Nodes        Nodes
(Actual      (Actual    (Actual      (Actual
 Data         Data       Data         Data
 Pointers)    Pointers)  Pointers)    Pointers)

<strong>How it works:</strong>
1. Search starts at root node
2. Traverses tree based on key values
3. Reaches leaf node with data pointer
4. Much faster than scanning entire table
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">7.2 Index Types</h3>
                
                <table class="comparison-table">
                  <thead>
                    <tr>
                      <th>Index Type</th>
                      <th>Description</th>
                      <th>Use Case</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Primary Key Index</strong></td>
                      <td>Automatically created on PRIMARY KEY<br>Clustered index (data sorted by this)</td>
                      <td>Main table identifier (id columns)</td>
                    </tr>
                    <tr>
                      <td><strong>Unique Index</strong></td>
                      <td>Ensures column values are unique<br>Can have multiple unique indexes</td>
                      <td>Email, username, SKU, social security number</td>
                    </tr>
                    <tr>
                      <td><strong>Regular Index</strong><br>(Non-unique)</td>
                      <td>Most common type<br>Speeds up searches on indexed columns</td>
                      <td>Foreign keys, frequently searched columns</td>
                    </tr>
                    <tr>
                      <td><strong>Composite Index</strong><br>(Multi-column)</td>
                      <td>Index on multiple columns<br>Order of columns matters!</td>
                      <td>Queries with multiple WHERE conditions</td>
                    </tr>
                    <tr>
                      <td><strong>Full-Text Index</strong></td>
                      <td>For text searching<br>Works with MATCH AGAINST</td>
                      <td>Search articles, descriptions, blog posts</td>
                    </tr>
                    <tr>
                      <td><strong>Spatial Index</strong></td>
                      <td>For geographic data<br>Works with GEOMETRY types</td>
                      <td>Location-based searches, maps</td>
                    </tr>
                    <tr>
                      <td><strong>Prefix Index</strong></td>
                      <td>Indexes only first N characters<br>Saves space for long strings</td>
                      <td>Long VARCHAR or TEXT columns</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">7.3 Creating and Managing Indexes</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Create regular index</span>
<span class="prompt">mysql></span> CREATE INDEX idx_last_name ON employees(last_name);

<span class="comment">-- Create unique index</span>
<span class="prompt">mysql></span> CREATE UNIQUE INDEX idx_email ON customers(email);

<span class="comment">-- Create composite index (multi-column)</span>
<span class="prompt">mysql></span> CREATE INDEX idx_name ON employees(last_name, first_name);
<span class="comment">-- Order matters! Good for: WHERE last_name = 'Smith'
--                      Good for: WHERE last_name = 'Smith' AND first_name = 'John'
--                      NOT good for: WHERE first_name = 'John' (doesn't use index)</span>

<span class="comment">-- Create index on column expression</span>
<span class="prompt">mysql></span> CREATE INDEX idx_upper_email ON customers((UPPER(email)));

<span class="comment">-- Create prefix index (first 10 characters)</span>
<span class="prompt">mysql></span> CREATE INDEX idx_description ON products(description(10));

<span class="comment">-- Create full-text index</span>
<span class="prompt">mysql></span> CREATE FULLTEXT INDEX idx_search ON articles(title, content);

<span class="comment">-- Create index during table creation</span>
<span class="prompt">mysql></span> CREATE TABLE products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(200),
    price DECIMAL(10,2),
    category_id INT,
    description TEXT,
    
    INDEX idx_price (price),
    INDEX idx_category (category_id),
    FULLTEXT INDEX idx_search (product_name, description)
);

<span class="comment">-- Add index using ALTER TABLE</span>
<span class="prompt">mysql></span> ALTER TABLE employees ADD INDEX idx_hire_date(hire_date);

<span class="comment">-- View all indexes on a table</span>
<span class="prompt">mysql></span> SHOW INDEXES FROM employees;
<span class="prompt">mysql></span> SHOW INDEX FROM employees;

<span class="comment">-- Drop index</span>
<span class="prompt">mysql></span> DROP INDEX idx_last_name ON employees;
<span class="prompt">mysql></span> ALTER TABLE employees DROP INDEX idx_last_name;

<span class="comment">-- Analyze index usage</span>
<span class="prompt">mysql></span> ANALYZE TABLE employees;

<span class="comment">-- Optimize table (rebuild indexes)</span>
<span class="prompt">mysql></span> OPTIMIZE TABLE employees;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">7.4 Query Performance Analysis</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- EXPLAIN - shows query execution plan</span>
<span class="prompt">mysql></span> EXPLAIN SELECT * FROM employees WHERE last_name = 'Smith';

<span class="comment">-- EXPLAIN output columns:
-- id: Query identifier
-- select_type: Type of SELECT (SIMPLE, PRIMARY, SUBQUERY, etc.)
-- table: Table being accessed
-- type: Join type (system, const, eq_ref, ref, range, index, ALL)
-- possible_keys: Indexes that could be used
-- key: Index actually used
-- key_len: Length of key used
-- ref: Columns compared to index
-- rows: Estimated rows to examine
-- Extra: Additional information</span>

<span class="comment">-- EXPLAIN ANALYZE (MySQL 8.0.18+) - shows actual execution</span>
<span class="prompt">mysql></span> EXPLAIN ANALYZE 
SELECT * FROM employees WHERE salary > 60000;

<span class="comment">-- Bad: Full table scan (type = ALL)</span>
<span class="prompt">mysql></span> EXPLAIN SELECT * FROM employees WHERE YEAR(hire_date) = 2024;
<span class="comment">-- Using function on column prevents index usage!</span>

<span class="comment">-- Good: Using index (type = ref or range)</span>
<span class="prompt">mysql></span> EXPLAIN SELECT * FROM employees 
WHERE hire_date BETWEEN '2024-01-01' AND '2024-12-31';

<span class="comment">-- Check index cardinality (uniqueness)</span>
<span class="prompt">mysql></span> SELECT 
    TABLE_NAME,
    INDEX_NAME,
    SEQ_IN_INDEX,
    COLUMN_NAME,
    CARDINALITY
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = 'your_database'
  AND TABLE_NAME = 'employees';

<span class="comment">-- Enable slow query log</span>
<span class="prompt">mysql></span> SET GLOBAL slow_query_log = 'ON';
<span class="prompt">mysql></span> SET GLOBAL long_query_time = 2;  <span class="comment">-- Log queries > 2 seconds</span>

<span class="comment">-- Show query execution time</span>
<span class="prompt">mysql></span> SET profiling = 1;
<span class="prompt">mysql></span> SELECT * FROM large_table WHERE column = 'value';
<span class="prompt">mysql></span> SHOW PROFILES;
<span class="prompt">mysql></span> SHOW PROFILE FOR QUERY 1;
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: Query Optimization Process</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Step 1: Identify slow query</span>
SELECT 
    o.order_id,
    c.customer_name,
    p.product_name
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= '2024-01-01'
  AND p.category_id = 5;

<span class="comment">-- Step 2: Analyze with EXPLAIN</span>
EXPLAIN SELECT ...;
<span class="comment">-- Results show:
-- - Full table scan on orders (type: ALL)
-- - Not using indexes effectively</span>

<span class="comment">-- Step 3: Create appropriate indexes</span>
CREATE INDEX idx_order_date ON orders(order_date);
CREATE INDEX idx_category ON products(category_id);
CREATE INDEX idx_customer ON orders(customer_id);
CREATE INDEX idx_order_items ON order_items(order_id, product_id);

<span class="comment">-- Step 4: Re-run EXPLAIN to verify improvement</span>
EXPLAIN SELECT ...;
<span class="comment">-- Now shows:
-- - Using index on orders (type: range)
-- - Using index on products (type: ref)
-- - Much fewer rows examined</span>

<span class="comment">-- Step 5: Test performance</span>
SET profiling = 1;
SELECT ...;
SHOW PROFILES;
<span class="comment">-- Query time reduced from 5.2s to 0.08s!</span>
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">7.5 Performance Optimization Tips</h3>
                
                <div class="component-grid">
                  <div class="component-card">
                    <h4>1️⃣ Index Strategy</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Index columns used in WHERE, JOIN, ORDER BY<br>
                      • Don't over-index (5-10 per table max)<br>
                      • Use composite indexes wisely
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>2️⃣ Query Optimization</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Avoid SELECT * (specify columns)<br>
                      • Use LIMIT for pagination<br>
                      • Avoid functions on indexed columns
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>3️⃣ Database Design</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Normalize to reduce redundancy<br>
                      • Use appropriate data types<br>
                      • Denormalize for read-heavy workloads
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>4️⃣ Join Optimization</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Index foreign key columns<br>
                      • Join on indexed columns<br>
                      • Use INNER JOIN when possible
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>5️⃣ Subquery Optimization</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Use JOINs instead of subqueries<br>
                      • Use EXISTS instead of IN for large datasets<br>
                      • Consider CTEs for readability
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>6️⃣ Data Types</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Use smallest type that fits data<br>
                      • INT is faster than VARCHAR for IDs<br>
                      • ENUM for fixed values
                    </p>
                  </div>
                </div>

                <div class="warning-box">
                  <strong>Common Performance Mistakes:</strong>
                  <ul>
                    <li>❌ Using SELECT * instead of specific columns</li>
                    <li>❌ Not indexing foreign keys</li>
                    <li>❌ Using functions on indexed columns in WHERE (breaks index)</li>
                    <li>❌ Too many indexes (slows INSERT/UPDATE/DELETE)</li>
                    <li>❌ Not using LIMIT for large result sets</li>
                    <li>❌ Using OR instead of UNION (can't use index efficiently)</li>
                    <li>❌ Storing large BLOBs in database (use file storage instead)</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div id="lesson8" class="lesson">
            <div class="lesson-header">
              <h2>Module 8: Security & User Management</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">8.1 MySQL User Management</h3>
                
                <div class="definition-box">
                  <p>
                    MySQL uses a privilege system to control access to databases and operations. Users are identified 
                    by username and hostname, and are granted specific privileges on database objects.
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- View current user</span>
<span class="prompt">mysql></span> SELECT USER(), CURRENT_USER();

<span class="comment">-- View all users</span>
<span class="prompt">mysql></span> SELECT User, Host FROM mysql.user;

<span class="comment">-- Create user (modern syntax)</span>
<span class="prompt">mysql></span> CREATE USER 'john'@'localhost' IDENTIFIED BY 'secure_password_123';

<span class="comment">-- Create user with specific host</span>
<span class="prompt">mysql></span> CREATE USER 'john'@'192.168.1.100' IDENTIFIED BY 'password';

<span class="comment">-- Create user accessible from any host</span>
<span class="prompt">mysql></span> CREATE USER 'john'@'%' IDENTIFIED BY 'password';

<span class="comment">-- Create user with password expiration</span>
<span class="prompt">mysql></span> CREATE USER 'john'@'localhost' 
IDENTIFIED BY 'password'
PASSWORD EXPIRE INTERVAL 90 DAY;

<span class="comment">-- Create user with failed login attempts limit</span>
<span class="prompt">mysql></span> CREATE USER 'john'@'localhost'
IDENTIFIED BY 'password'
FAILED_LOGIN_ATTEMPTS 3
PASSWORD_LOCK_TIME 2;  <span class="comment">-- Lock for 2 days after 3 failed attempts</span>

<span class="comment">-- Rename user</span>
<span class="prompt">mysql></span> RENAME USER 'john'@'localhost' TO 'john_doe'@'localhost';

<span class="comment">-- Change user password</span>
<span class="prompt">mysql></span> ALTER USER 'john'@'localhost' IDENTIFIED BY 'new_password';
<span class="prompt">mysql></span> SET PASSWORD FOR 'john'@'localhost' = 'new_password';

<span class="comment">-- Change own password</span>
<span class="prompt">mysql></span> SET PASSWORD = 'new_password';

<span class="comment">-- Drop user</span>
<span class="prompt">mysql></span> DROP USER 'john'@'localhost';

<span class="comment">-- Drop multiple users</span>
<span class="prompt">mysql></span> DROP USER 'user1'@'localhost', 'user2'@'localhost';

<span class="comment">-- Lock/Unlock user account</span>
<span class="prompt">mysql></span> ALTER USER 'john'@'localhost' ACCOUNT LOCK;
<span class="prompt">mysql></span> ALTER USER 'john'@'localhost' ACCOUNT UNLOCK;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">8.2 Granting and Revoking Privileges</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">Privilege Levels</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Level</th>
                        <th>Syntax</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>Global</strong></td>
                        <td><code>ON *.*</code></td>
                        <td>All databases and tables</td>
                      </tr>
                      <tr>
                        <td><strong>Database</strong></td>
                        <td><code>ON database_name.*</code></td>
                        <td>All tables in specific database</td>
                      </tr>
                      <tr>
                        <td><strong>Table</strong></td>
                        <td><code>ON database.table</code></td>
                        <td>Specific table</td>
                      </tr>
                      <tr>
                        <td><strong>Column</strong></td>
                        <td><code>column_name</code></td>
                        <td>Specific columns in table</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Common Privileges</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Privilege</th>
                        <th>Description</th>
                        <th>Use Case</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>ALL PRIVILEGES</strong></td>
                        <td>All privileges except GRANT OPTION</td>
                        <td>Full access (admin)</td>
                      </tr>
                      <tr>
                        <td><strong>SELECT</strong></td>
                        <td>Read data from tables</td>
                        <td>Read-only users, reporting</td>
                      </tr>
                      <tr>
                        <td><strong>INSERT</strong></td>
                        <td>Add new rows to tables</td>
                        <td>Data entry applications</td>
                      </tr>
                      <tr>
                        <td><strong>UPDATE</strong></td>
                        <td>Modify existing data</td>
                        <td>Data modification apps</td>
                      </tr>
                      <tr>
                        <td><strong>DELETE</strong></td>
                        <td>Remove rows from tables</td>
                        <td>Data management apps</td>
                      </tr>
                      <tr>
                        <td><strong>CREATE</strong></td>
                        <td>Create databases and tables</td>
                        <td>Developers, admins</td>
                      </tr>
                      <tr>
                        <td><strong>DROP</strong></td>
                        <td>Delete databases and tables</td>
                        <td>Admins only</td>
                      </tr>
                      <tr>
                        <td><strong>ALTER</strong></td>
                        <td>Modify table structure</td>
                        <td>Database designers</td>
                      </tr>
                      <tr>
                        <td><strong>INDEX</strong></td>
                        <td>Create/drop indexes</td>
                        <td>Performance tuning</td>
                      </tr>
                      <tr>
                        <td><strong>EXECUTE</strong></td>
                        <td>Run stored procedures</td>
                        <td>Application users</td>
                      </tr>
                      <tr>
                        <td><strong>GRANT OPTION</strong></td>
                        <td>Grant privileges to other users</td>
                        <td>Admin delegation</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Grant all privileges on all databases (superuser)</span>
<span class="prompt">mysql></span> GRANT ALL PRIVILEGES ON *.* TO 'admin'@'localhost';

<span class="comment">-- Grant all privileges on specific database</span>
<span class="prompt">mysql></span> GRANT ALL PRIVILEGES ON company.* TO 'app_user'@'localhost';

<span class="comment">-- Grant specific privileges on database</span>
<span class="prompt">mysql></span> GRANT SELECT, INSERT, UPDATE, DELETE ON company.* 
TO 'app_user'@'localhost';

<span class="comment">-- Grant privileges on specific table</span>
<span class="prompt">mysql></span> GRANT SELECT, INSERT ON company.employees 
TO 'hr_user'@'localhost';

<span class="comment">-- Grant column-level privileges</span>
<span class="prompt">mysql></span> GRANT SELECT (first_name, last_name, email), 
UPDATE (email, phone) ON company.employees 
TO 'limited_user'@'localhost';

<span class="comment">-- Grant with GRANT OPTION (user can grant to others)</span>
<span class="prompt">mysql></span> GRANT SELECT, INSERT ON company.* 
TO 'team_lead'@'localhost' 
WITH GRANT OPTION;

<span class="comment">-- Grant EXECUTE on stored procedure</span>
<span class="prompt">mysql></span> GRANT EXECUTE ON PROCEDURE company.get_employee_salary 
TO 'app_user'@'localhost';

<span class="comment">-- Grant read-only access</span>
<span class="prompt">mysql></span> GRANT SELECT ON company.* TO 'readonly_user'@'localhost';

<span class="comment">-- View user privileges</span>
<span class="prompt">mysql></span> SHOW GRANTS FOR 'john'@'localhost';
<span class="prompt">mysql></span> SHOW GRANTS FOR CURRENT_USER();

<span class="comment">-- Revoke privileges</span>
<span class="prompt">mysql></span> REVOKE DELETE ON company.* FROM 'app_user'@'localhost';

<span class="comment">-- Revoke all privileges</span>
<span class="prompt">mysql></span> REVOKE ALL PRIVILEGES ON company.* FROM 'app_user'@'localhost';

<span class="comment">-- Reload privilege tables (apply changes immediately)</span>
<span class="prompt">mysql></span> FLUSH PRIVILEGES;
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: Role-Based Access Control</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Create roles (MySQL 8.0+)</span>
CREATE ROLE 'app_developer', 'app_read', 'app_write', 'admin_role';

<span class="comment">-- Grant privileges to roles</span>
GRANT SELECT ON company.* TO 'app_read';
GRANT INSERT, UPDATE ON company.* TO 'app_write';
GRANT ALL PRIVILEGES ON company.* TO 'app_developer';
GRANT ALL PRIVILEGES ON *.* TO 'admin_role';

<span class="comment">-- Create users and assign roles</span>
CREATE USER 'developer1'@'localhost' IDENTIFIED BY 'password';
GRANT 'app_developer' TO 'developer1'@'localhost';

CREATE USER 'analyst1'@'localhost' IDENTIFIED BY 'password';
GRANT 'app_read' TO 'analyst1'@'localhost';

CREATE USER 'app_user1'@'localhost' IDENTIFIED BY 'password';
GRANT 'app_read', 'app_write' TO 'app_user1'@'localhost';

<span class="comment">-- Set default role for user</span>
SET DEFAULT ROLE ALL TO 'app_user1'@'localhost';

<span class="comment">-- View role assignments</span>
SHOW GRANTS FOR 'app_user1'@'localhost';

<span class="comment">-- Revoke role from user</span>
REVOKE 'app_write' FROM 'app_user1'@'localhost';

<span class="comment">-- Drop role</span>
DROP ROLE 'app_developer';
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">8.3 Database Security Best Practices</h3>
                
                <div class="component-grid">
                  <div class="component-card">
                    <h4>🔐 Password Security</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Use strong passwords (12+ chars)<br>
                      • Enable password expiration<br>
                      • Enforce password complexity
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>👥 User Management</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Principle of least privilege<br>
                      • Create separate users per app<br>
                      • Remove unused accounts
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>🌐 Network Security</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Use SSL/TLS for connections<br>
                      • Restrict by IP/hostname<br>
                      • Don't expose to public internet
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>📊 Monitoring</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Enable audit logging<br>
                      • Monitor failed login attempts<br>
                      • Review user activity logs
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>💾 Backup</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Regular automated backups<br>
                      • Test restore procedures<br>
                      • Encrypt backup files
                    </p>
                  </div>
                  
                  <div class="component-card">
                    <h4>🔄 Updates</h4>
                    <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                      • Keep MySQL up to date<br>
                      • Apply security patches<br>
                      • Monitor CVE database
                    </p>
                  </div>
                </div>

                <div class="warning-box">
                  <strong>Security Checklist:</strong>
                  <ul>
                    <li>✅ Never use root account for applications</li>
                    <li>✅ Remove anonymous users</li>
                    <li>✅ Remove test databases in production</li>
                    <li>✅ Disable remote root login</li>
                    <li>✅ Use strong authentication plugins</li>
                    <li>✅ Enable SSL for remote connections</li>
                    <li>✅ Restrict file system access</li>
                    <li>✅ Use prepared statements (prevent SQL injection)</li>
                    <li>✅ Encrypt sensitive data at rest</li>
                    <li>✅ Regular security audits</li>
                  </ul>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Secure MySQL installation (run after installation)</span>
<span class="prompt">$</span> mysql_secure_installation

<span class="comment">-- Check for users without passwords (security risk!)</span>
<span class="prompt">mysql></span> SELECT User, Host, authentication_string 
FROM mysql.user 
WHERE authentication_string = '';

<span class="comment">-- Remove anonymous users</span>
<span class="prompt">mysql></span> DELETE FROM mysql.user WHERE User = '';

<span class="comment">-- Remove test database</span>
<span class="prompt">mysql></span> DROP DATABASE IF EXISTS test;

<span class="comment">-- Disable remote root login</span>
<span class="prompt">mysql></span> DELETE FROM mysql.user 
WHERE User = 'root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');

<span class="comment">-- Enable SSL (in my.cnf)</span>
[mysqld]
require_secure_transport = ON
ssl-ca=/path/to/ca.pem
ssl-cert=/path/to/server-cert.pem
ssl-key=/path/to/server-key.pem

<span class="comment">-- Force SSL for specific user</span>
<span class="prompt">mysql></span> ALTER USER 'john'@'%' REQUIRE SSL;

<span class="comment">-- Set password expiration policy</span>
<span class="prompt">mysql></span> SET GLOBAL default_password_lifetime = 90;

<span class="comment">-- View login history</span>
<span class="prompt">mysql></span> SELECT * FROM mysql.general_log 
WHERE command_type = 'Connect' 
ORDER BY event_time DESC 
LIMIT 100;
</pre>
                </div>
              </div>
            </div>
          </div>

          <div id="lesson9" class="lesson">
            <div class="lesson-header">
              <h2>Module 9: Advanced Topics</h2>
            </div>
            <div class="lesson-content">
              <div class="section">
                <h3 class="section-title">9.1 Views</h3>
                
                <div class="definition-box">
                  <p>
                    A <strong>View</strong> is a virtual table based on a SELECT query. It doesn't store data itself 
                    but presents data from underlying tables. Views are stored permanently in the database.
                  </p>
                </div>

                <div class="highlight-box">
                  <p><strong>View Benefits:</strong></p>
                  <ul>
                    <li>🔒 <strong>Security:</strong> Hide sensitive columns, show only necessary data</li>
                    <li>♻️ <strong>Reusability:</strong> Store complex queries for repeated use</li>
                    <li>🎯 <strong>Simplification:</strong> Hide complexity of JOINs and subqueries</li>
                    <li>📊 <strong>Abstraction:</strong> Present data differently without changing base tables</li>
                    <li>🏛️ <strong>Logical Layer:</strong> Create virtual data marts for analytics</li>
                  </ul>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Create simple view</span>
<span class="prompt">mysql></span> CREATE VIEW employee_names AS
SELECT employee_id, first_name, last_name, email
FROM employees;

<span class="comment">-- Use view like a table</span>
<span class="prompt">mysql></span> SELECT * FROM employee_names;

<span class="comment">-- Create view with JOIN</span>
<span class="prompt">mysql></span> CREATE VIEW employee_details AS
SELECT 
    e.employee_id,
    CONCAT(e.first_name, ' ', e.last_name) AS full_name,
    e.email,
    d.department_name,
    e.salary,
    e.hire_date
FROM employees e
JOIN departments d ON e.department_id = d.department_id;

<span class="comment">-- Create view with aggregation</span>
<span class="prompt">mysql></span> CREATE VIEW department_stats AS
SELECT 
    d.department_name,
    COUNT(e.employee_id) AS employee_count,
    AVG(e.salary) AS avg_salary,
    MAX(e.salary) AS max_salary,
    MIN(e.salary) AS min_salary
FROM departments d
LEFT JOIN employees e ON d.department_id = e.department_id
GROUP BY d.department_id, d.department_name;

<span class="comment">-- Create view with WHERE clause (filtered view)</span>
<span class="prompt">mysql></span> CREATE VIEW high_earners AS
SELECT employee_id, first_name, last_name, salary
FROM employees
WHERE salary > 70000;

<span class="comment">-- Create or replace view (update existing)</span>
<span class="prompt">mysql></span> CREATE OR REPLACE VIEW employee_names AS
SELECT employee_id, first_name, last_name, email, phone
FROM employees;

<span class="comment">-- View with calculated columns</span>
<span class="prompt">mysql></span> CREATE VIEW product_pricing AS
SELECT 
    product_id,
    product_name,
    price AS original_price,
    price * 0.9 AS sale_price,
    price * 0.1 AS discount_amount
FROM products;

<span class="comment">-- Show view definition</span>
<span class="prompt">mysql></span> SHOW CREATE VIEW employee_names;

<span class="comment">-- List all views</span>
<span class="prompt">mysql></span> SHOW FULL TABLES WHERE TABLE_TYPE = 'VIEW';

<span class="comment">-- Drop view</span>
<span class="prompt">mysql></span> DROP VIEW employee_names;
<span class="prompt">mysql></span> DROP VIEW IF EXISTS employee_names;

<span class="comment">-- Update through view (limited support)</span>
<span class="prompt">mysql></span> UPDATE employee_names 
SET email = 'newemail@example.com' 
WHERE employee_id = 1;
<span class="comment">-- Only works if view is updatable (no JOIN, GROUP BY, DISTINCT, etc.)</span>
</pre>
                </div>

                <div class="comparison-table">
                  <thead>
                    <tr>
                      <th>Feature</th>
                      <th>View</th>
                      <th>Table</th>
                      <th>CTE</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td><strong>Data Storage</strong></td>
                      <td>❌ Virtual (no data stored)</td>
                      <td>✅ Physical data</td>
                      <td>❌ Temporary (query only)</td>
                    </tr>
                    <tr>
                      <td><strong>Persistence</strong></td>
                      <td>✅ Permanent</td>
                      <td>✅ Permanent</td>
                      <td>❌ Single query</td>
                    </tr>
                    <tr>
                      <td><strong>Reusability</strong></td>
                      <td>✅ Across queries/apps</td>
                      <td>✅ Across queries/apps</td>
                      <td>❌ Single query only</td>
                    </tr>
                    <tr>
                      <td><strong>Performance</strong></td>
                      <td>⚠️ Query executed each time</td>
                      <td>✅ Fast (indexed)</td>
                      <td>⚠️ Query executed each time</td>
                    </tr>
                    <tr>
                      <td><strong>Disk Space</strong></td>
                      <td>✅ Minimal</td>
                      <td>❌ Can be large</td>
                      <td>✅ None</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="section">
                <h3 class="section-title">9.2 Stored Procedures</h3>
                
                <div class="definition-box">
                  <p>
                    A <strong>Stored Procedure</strong> is a prepared SQL code that you can save and reuse. 
                    It can accept parameters, include logic (IF, WHILE, CASE), and perform multiple operations.
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- Change delimiter (needed for procedure creation)</span>
<span class="prompt">mysql></span> DELIMITER $$

<span class="comment">-- Basic stored procedure</span>
<span class="prompt">mysql></span> CREATE PROCEDURE get_all_employees()
BEGIN
    SELECT * FROM employees;
END$$

<span class="prompt">mysql></span> DELIMITER ;

<span class="comment">-- Call stored procedure</span>
<span class="prompt">mysql></span> CALL get_all_employees();

<span class="comment">-- Procedure with IN parameter</span>
DELIMITER $$
CREATE PROCEDURE get_employee_by_id(IN emp_id INT)
BEGIN
    SELECT * FROM employees WHERE employee_id = emp_id;
END$$
DELIMITER ;

CALL get_employee_by_id(5);

<span class="comment">-- Procedure with multiple parameters</span>
DELIMITER $$
CREATE PROCEDURE add_employee(
    IN p_first_name VARCHAR(50),
    IN p_last_name VARCHAR(50),
    IN p_email VARCHAR(100),
    IN p_department_id INT
)
BEGIN
    INSERT INTO employees (first_name, last_name, email, department_id, hire_date)
    VALUES (p_first_name, p_last_name, p_email, p_department_id, CURDATE());
END$$
DELIMITER ;

CALL add_employee('John', 'Doe', 'john@example.com', 1);

<span class="comment">-- Procedure with OUT parameter</span>
DELIMITER $$
CREATE PROCEDURE get_employee_count(OUT emp_count INT)
BEGIN
    SELECT COUNT(*) INTO emp_count FROM employees;
END$$
DELIMITER ;

CALL get_employee_count(@count);
SELECT @count AS employee_count;

<span class="comment">-- Procedure with INOUT parameter</span>
DELIMITER $$
CREATE PROCEDURE increase_salary(INOUT salary DECIMAL(10,2), IN percentage INT)
BEGIN
    SET salary = salary + (salary * percentage / 100);
END$$
DELIMITER ;

SET @current_salary = 50000;
CALL increase_salary(@current_salary, 10);
SELECT @current_salary;  <span class="comment">-- 55000</span>

<span class="comment">-- Procedure with IF statement</span>
DELIMITER $$
CREATE PROCEDURE classify_salary(IN emp_id INT, OUT classification VARCHAR(20))
BEGIN
    DECLARE emp_salary DECIMAL(10,2);
    
    SELECT salary INTO emp_salary 
    FROM employees 
    WHERE employee_id = emp_id;
    
    IF emp_salary > 80000 THEN
        SET classification = 'High';
    ELSEIF emp_salary > 50000 THEN
        SET classification = 'Medium';
    ELSE
        SET classification = 'Low';
    END IF;
END$$
DELIMITER ;

CALL classify_salary(1, @class);
SELECT @class;

<span class="comment">-- Procedure with WHILE loop</span>
DELIMITER $$
CREATE PROCEDURE insert_numbers(IN max_num INT)
BEGIN
    DECLARE counter INT DEFAULT 1;
    
    WHILE counter <= max_num DO
        INSERT INTO numbers (num) VALUES (counter);
        SET counter = counter + 1;
    END WHILE;
END$$
DELIMITER ;

<span class="comment">-- Procedure with error handling</span>
DELIMITER $$
CREATE PROCEDURE safe_delete_employee(IN emp_id INT)
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SELECT 'Error occurred, transaction rolled back' AS message;
    END;
    
    START TRANSACTION;
    
    DELETE FROM employee_projects WHERE employee_id = emp_id;
    DELETE FROM employees WHERE employee_id = emp_id;
    
    COMMIT;
    SELECT 'Employee deleted successfully' AS message;
END$$
DELIMITER ;

<span class="comment">-- View all procedures</span>
<span class="prompt">mysql></span> SHOW PROCEDURE STATUS WHERE Db = 'company';

<span class="comment">-- Show procedure definition</span>
<span class="prompt">mysql></span> SHOW CREATE PROCEDURE get_all_employees;

<span class="comment">-- Drop procedure</span>
<span class="prompt">mysql></span> DROP PROCEDURE IF EXISTS get_all_employees;
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.3 Triggers</h3>
                
                <div class="definition-box">
                  <p>
                    A <strong>Trigger</strong> is a stored procedure that automatically executes when a specific 
                    event occurs on a table (INSERT, UPDATE, or DELETE). Triggers are useful for maintaining 
                    audit logs, enforcing business rules, and data validation.
                  </p>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- BEFORE INSERT trigger</span>
DELIMITER $$
CREATE TRIGGER before_employee_insert
BEFORE INSERT ON employees
FOR EACH ROW
BEGIN
    <span class="comment">-- Automatically set email to lowercase</span>
    SET NEW.email = LOWER(NEW.email);
    
    <span class="comment">-- Set created_at timestamp</span>
    SET NEW.created_at = NOW();
END$$
DELIMITER ;

<span class="comment">-- AFTER INSERT trigger (audit log)</span>
DELIMITER $$
CREATE TRIGGER after_employee_insert
AFTER INSERT ON employees
FOR EACH ROW
BEGIN
    INSERT INTO employee_audit_log (
        employee_id,
        action,
        action_date,
        action_by
    )
    VALUES (
        NEW.employee_id,
        'INSERT',
        NOW(),
        USER()
    );
END$$
DELIMITER ;

<span class="comment">-- BEFORE UPDATE trigger</span>
DELIMITER $$
CREATE TRIGGER before_employee_update
BEFORE UPDATE ON employees
FOR EACH ROW
BEGIN
    <span class="comment">-- Prevent salary decrease</span>
    IF NEW.salary < OLD.salary THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Salary cannot be decreased';
    END IF;
    
    <span class="comment">-- Update modified timestamp</span>
    SET NEW.updated_at = NOW();
END$$
DELIMITER ;

<span class="comment">-- AFTER UPDATE trigger (track changes)</span>
DELIMITER $$
CREATE TRIGGER after_employee_update
AFTER UPDATE ON employees
FOR EACH ROW
BEGIN
    IF NEW.salary != OLD.salary THEN
        INSERT INTO salary_history (
            employee_id,
            old_salary,
            new_salary,
            changed_date,
            changed_by
        )
        VALUES (
            NEW.employee_id,
            OLD.salary,
            NEW.salary,
            NOW(),
            USER()
        );
    END IF;
END$$
DELIMITER ;

<span class="comment">-- BEFORE DELETE trigger (prevent deletion)</span>
DELIMITER $$
CREATE TRIGGER before_employee_delete
BEFORE DELETE ON employees
FOR EACH ROW
BEGIN
    <span class="comment">-- Prevent deletion of employees with salary > 100000</span>
    IF OLD.salary > 100000 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Cannot delete high-earning employees';
    END IF;
END$$
DELIMITER ;

<span class="comment">-- AFTER DELETE trigger (soft delete)</span>
DELIMITER $$
CREATE TRIGGER after_employee_delete
AFTER DELETE ON employees
FOR EACH ROW
BEGIN
    INSERT INTO deleted_employees
    SELECT *, NOW() AS deleted_at, USER() AS deleted_by
    FROM (SELECT 
            OLD.employee_id,
            OLD.first_name,
            OLD.last_name,
            OLD.email,
            OLD.salary
         ) AS old_data;
END$$
DELIMITER ;

<span class="comment">-- Trigger to update denormalized data</span>
DELIMITER $$
CREATE TRIGGER after_order_item_insert
AFTER INSERT ON order_items
FOR EACH ROW
BEGIN
    <span class="comment">-- Update order total</span>
    UPDATE orders
    SET total_amount = (
        SELECT SUM(quantity * unit_price)
        FROM order_items
        WHERE order_id = NEW.order_id
    )
    WHERE order_id = NEW.order_id;
    
    <span class="comment">-- Update product stock</span>
    UPDATE products
    SET stock_quantity = stock_quantity - NEW.quantity
    WHERE product_id = NEW.product_id;
END$$
DELIMITER ;

<span class="comment">-- View all triggers</span>
<span class="prompt">mysql></span> SHOW TRIGGERS;
<span class="prompt">mysql></span> SHOW TRIGGERS FROM company;

<span class="comment">-- Show trigger definition</span>
<span class="prompt">mysql></span> SHOW CREATE TRIGGER before_employee_insert;

<span class="comment">-- Drop trigger</span>
<span class="prompt">mysql></span> DROP TRIGGER IF EXISTS before_employee_insert;
</pre>
                </div>

                <div class="warning-box">
                  <strong>Trigger Best Practices:</strong>
                  <ul>
                    <li>⚠️ Keep triggers simple and fast (they execute with every operation)</li>
                    <li>⚠️ Avoid complex logic in triggers (use stored procedures instead)</li>
                    <li>⚠️ Don't call other triggers (can create loops)</li>
                    <li>⚠️ Document trigger behavior (they're "invisible" to developers)</li>
                    <li>✅ Use for audit logging, automatic timestamps, data validation</li>
                    <li>✅ Test thoroughly (triggers can cause unexpected behavior)</li>
                  </ul>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.4 Window Functions</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Window Functions</strong> (MySQL 8.0+) perform calculations across rows related to the 
                    current row, without collapsing rows like GROUP BY does. They're powerful for analytics, 
                    rankings, and running totals.
                  </p>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Window Function Syntax</h4>
                  <div class="code-box">
<pre>function_name() OVER (
    [PARTITION BY column1, column2, ...]
    [ORDER BY column1 [ASC|DESC], ...]
    [ROWS/RANGE frame_specification]
)

<strong>Components:</strong>
- PARTITION BY: Divides rows into groups (like GROUP BY but keeps detail)
- ORDER BY: Defines order within partition
- Frame: Defines subset of partition for calculation
</pre>
                  </div>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- ROW_NUMBER() - Unique sequential number</span>
<span class="prompt">mysql></span> SELECT 
    employee_id,
    first_name,
    last_name,
    salary,
    ROW_NUMBER() OVER (ORDER BY salary DESC) AS salary_rank
FROM employees;

<span class="comment">-- RANK() - Rank with gaps for ties</span>
<span class="prompt">mysql></span> SELECT 
    employee_id,
    first_name,
    salary,
    RANK() OVER (ORDER BY salary DESC) AS rank_with_gaps
FROM employees;
<span class="comment">-- If two employees have same salary (rank 1), next rank is 3</span>

<span class="comment">-- DENSE_RANK() - Rank without gaps</span>
<span class="prompt">mysql></span> SELECT 
    employee_id,
    first_name,
    salary,
    DENSE_RANK() OVER (ORDER BY salary DESC) AS rank_no_gaps
FROM employees;
<span class="comment">-- If two employees have same salary (rank 1), next rank is 2</span>

<span class="comment">-- Partition by department</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    employee_id,
    first_name,
    salary,
    RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS dept_rank
FROM employees;
<span class="comment">-- Ranks reset for each department</span>

<span class="comment">-- NTILE() - Divide into N groups</span>
<span class="prompt">mysql></span> SELECT 
    employee_id,
    first_name,
    salary,
    NTILE(4) OVER (ORDER BY salary) AS salary_quartile
FROM employees;
<span class="comment">-- Divides employees into 4 equal groups</span>

<span class="comment">-- LAG() - Access previous row</span>
<span class="prompt">mysql></span> SELECT 
    order_id,
    order_date,
    total_amount,
    LAG(total_amount) OVER (ORDER BY order_date) AS previous_order_amount,
    total_amount - LAG(total_amount) OVER (ORDER BY order_date) AS difference
FROM orders;

<span class="comment">-- LEAD() - Access next row</span>
<span class="prompt">mysql></span> SELECT 
    order_id,
    order_date,
    total_amount,
    LEAD(total_amount) OVER (ORDER BY order_date) AS next_order_amount
FROM orders;

<span class="comment">-- FIRST_VALUE() and LAST_VALUE()</span>
<span class="prompt">mysql></span> SELECT 
    employee_id,
    department_id,
    salary,
    FIRST_VALUE(salary) OVER (PARTITION BY department_id ORDER BY salary) AS lowest_in_dept,
    LAST_VALUE(salary) OVER (
        PARTITION BY department_id 
        ORDER BY salary
        RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS highest_in_dept
FROM employees;

<span class="comment">-- Running total (SUM with frame)</span>
<span class="prompt">mysql></span> SELECT 
    order_date,
    total_amount,
    SUM(total_amount) OVER (
        ORDER BY order_date
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS running_total
FROM orders;

<span class="comment">-- Moving average (last 3 rows)</span>
<span class="prompt">mysql></span> SELECT 
    order_date,
    total_amount,
    AVG(total_amount) OVER (
        ORDER BY order_date
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) AS moving_avg_3
FROM orders;

<span class="comment">-- Aggregate functions as window functions</span>
<span class="prompt">mysql></span> SELECT 
    department_id,
    employee_id,
    first_name,
    salary,
    AVG(salary) OVER (PARTITION BY department_id) AS dept_avg_salary,
    salary - AVG(salary) OVER (PARTITION BY department_id) AS diff_from_avg,
    COUNT(*) OVER (PARTITION BY department_id) AS dept_employee_count
FROM employees;

<span class="comment">-- Complex example: Top 3 products per category</span>
<span class="prompt">mysql></span> SELECT * FROM (
    SELECT 
        c.category_name,
        p.product_name,
        p.price,
        ROW_NUMBER() OVER (PARTITION BY c.category_id ORDER BY p.price DESC) AS price_rank
    FROM products p
    JOIN categories c ON p.category_id = c.category_id
) ranked
WHERE price_rank <= 3;

<span class="comment">-- Year-over-year comparison</span>
<span class="prompt">mysql></span> SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    SUM(total_amount) AS monthly_revenue,
    LAG(SUM(total_amount), 12) OVER (ORDER BY YEAR(order_date), MONTH(order_date)) AS last_year_revenue,
    SUM(total_amount) - LAG(SUM(total_amount), 12) OVER (ORDER BY YEAR(order_date), MONTH(order_date)) AS yoy_growth
FROM orders
GROUP BY YEAR(order_date), MONTH(order_date);
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.5 Backup and Recovery</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- Backup entire database (command line)</span>
<span class="prompt">$</span> mysqldump -u root -p company > company_backup.sql

<span class="comment">-- Backup specific tables</span>
<span class="prompt">$</span> mysqldump -u root -p company employees departments > tables_backup.sql

<span class="comment">-- Backup all databases</span>
<span class="prompt">$</span> mysqldump -u root -p --all-databases > all_databases_backup.sql

<span class="comment">-- Backup with compression</span>
<span class="prompt">$</span> mysqldump -u root -p company | gzip > company_backup.sql.gz

<span class="comment">-- Backup structure only (no data)</span>
<span class="prompt">$</span> mysqldump -u root -p --no-data company > company_structure.sql

<span class="comment">-- Backup data only (no structure)</span>
<span class="prompt">$</span> mysqldump -u root -p --no-create-info company > company_data.sql

<span class="comment">-- Restore database</span>
<span class="prompt">$</span> mysql -u root -p company < company_backup.sql

<span class="comment">-- Restore compressed backup</span>
<span class="prompt">$</span> gunzip < company_backup.sql.gz | mysql -u root -p company

<span class="comment">-- Restore all databases</span>
<span class="prompt">$</span> mysql -u root -p < all_databases_backup.sql

<span class="comment">-- Backup with specific options</span>
<span class="prompt">$</span> mysqldump -u root -p \
  --single-transaction \    <span class="comment"># Consistent backup without locking</span>
  --routines \              <span class="comment"># Include stored procedures</span>
  --triggers \              <span class="comment"># Include triggers</span>
  --events \                <span class="comment"># Include scheduled events</span>
  company > company_full_backup.sql

<span class="comment">-- Automated backup script (bash)</span>
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups/mysql"
DB_NAME="company"
DB_USER="backup_user"
DB_PASS="secure_password"

mkdir -p $BACKUP_DIR

mysqldump -u $DB_USER -p$DB_PASS \
  --single-transaction \
  --routines \
  --triggers \
  $DB_NAME | gzip > $BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz

<span class="comment"># Delete backups older than 30 days</span>
find $BACKUP_DIR -name "*.sql.gz" -mtime +30 -delete

<span class="comment">-- Point-in-time recovery (requires binary logs)</span>
<span class="comment"># 1. Restore last full backup</span>
<span class="prompt">$</span> mysql -u root -p company < last_backup.sql

<span class="comment"># 2. Apply binary logs up to specific time</span>
<span class="prompt">$</span> mysqlbinlog --stop-datetime="2025-10-20 14:30:00" \
  /var/log/mysql/mysql-bin.000001 | mysql -u root -p company
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.6 MySQL Configuration & Optimization</h3>
                
                <div class="sql-command">
<pre><span class="comment">-- View current settings</span>
<span class="prompt">mysql></span> SHOW VARIABLES;
<span class="prompt">mysql></span> SHOW VARIABLES LIKE 'max_connections';
<span class="prompt">mysql></span> SHOW VARIABLES LIKE '%buffer%';

<span class="comment">-- View status variables</span>
<span class="prompt">mysql></span> SHOW STATUS;
<span class="prompt">mysql></span> SHOW STATUS LIKE 'Threads%';

<span class="comment">-- View current processes</span>
<span class="prompt">mysql></span> SHOW PROCESSLIST;
<span class="prompt">mysql></span> SHOW FULL PROCESSLIST;

<span class="comment">-- Kill long-running query</span>
<span class="prompt">mysql></span> KILL QUERY 123;  <span class="comment">-- Process ID from SHOW PROCESSLIST</span>
<span class="prompt">mysql></span> KILL 123;        <span class="comment">-- Kill entire connection</span>

<span class="comment">-- Important my.cnf settings (Linux: /etc/mysql/my.cnf)</span>
[mysqld]
# Connection settings
max_connections = 500
connect_timeout = 10

# Buffer settings
innodb_buffer_pool_size = 4G     <span class="comment"># 70-80% of RAM for dedicated server</span>
innodb_log_file_size = 512M
innodb_log_buffer_size = 16M

# Query cache (deprecated in MySQL 8.0)
query_cache_type = 0
query_cache_size = 0

# Temporary tables
tmp_table_size = 64M
max_heap_table_size = 64M

# Binary logging (for replication and point-in-time recovery)
log_bin = /var/log/mysql/mysql-bin
expire_logs_days = 14
max_binlog_size = 100M

# Slow query log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow-query.log
long_query_time = 2
log_queries_not_using_indexes = 1

<span class="comment"># Character set</span>
character_set_server = utf8mb4
collation_server = utf8mb4_unicode_ci

# InnoDB settings
innodb_flush_log_at_trx_commit = 1  <span class="comment"># 1=safe, 2=faster but less safe</span>
innodb_file_per_table = 1
innodb_flush_method = O_DIRECT

# Performance schema
performance_schema = ON

<span class="comment">-- View table statistics</span>
<span class="prompt">mysql></span> SELECT 
    table_schema AS 'Database',
    table_name AS 'Table',
    table_rows AS 'Rows',
    ROUND(data_length / 1024 / 1024, 2) AS 'Data Size (MB)',
    ROUND(index_length / 1024 / 1024, 2) AS 'Index Size (MB)',
    ROUND((data_length + index_length) / 1024 / 1024, 2) AS 'Total Size (MB)'
FROM information_schema.tables
WHERE table_schema = 'company'
ORDER BY (data_length + index_length) DESC;

<span class="comment">-- Check table fragmentation</span>
<span class="prompt">mysql></span> SELECT 
    table_name,
    ROUND(data_length / 1024 / 1024, 2) AS data_mb,
    ROUND(data_free / 1024 / 1024, 2) AS free_mb,
    ROUND(data_free / data_length * 100, 2) AS fragmentation_pct
FROM information_schema.tables
WHERE table_schema = 'company'
  AND data_free > 0
ORDER BY fragmentation_pct DESC;

<span class="comment">-- Optimize fragmented tables</span>
<span class="prompt">mysql></span> OPTIMIZE TABLE employees;

<span class="comment">-- Check InnoDB buffer pool usage</span>
<span class="prompt">mysql></span> SHOW STATUS LIKE 'Innodb_buffer_pool%';

<span class="comment">-- Monitor connection usage</span>
<span class="prompt">mysql></span> SHOW STATUS LIKE 'Threads_connected';
<span class="prompt">mysql></span> SHOW STATUS LIKE 'Max_used_connections';
<span class="prompt">mysql></span> SHOW VARIABLES LIKE 'max_connections';
</pre>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.7 Partitioning</h3>
                
                <div class="definition-box">
                  <p>
                    <strong>Partitioning</strong> divides a large table into smaller, more manageable pieces called 
                    partitions. Each partition is stored separately but the table appears as a single logical unit. 
                    This improves query performance, maintenance, and data management.
                  </p>
                </div>

                <div class="highlight-box">
                  <p><strong>Partitioning Benefits:</strong></p>
                  <ul>
                    <li>⚡ <strong>Improved I/O:</strong> Queries access only relevant partitions</li>
                    <li>🔀 <strong>Parallel Processing:</strong> Different partitions processed concurrently</li>
                    <li>📦 <strong>Easier Maintenance:</strong> Backup, restore, or drop old data by partition</li>
                    <li>📊 <strong>Better Performance:</strong> Smaller indexes per partition</li>
                    <li>🗑️ <strong>Efficient Archiving:</strong> Drop old partitions instead of DELETE</li>
                  </ul>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Partition Types</h4>
                  <table class="comparison-table">
                    <thead>
                      <tr>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Use Case</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>RANGE</strong></td>
                        <td>Partition by value ranges</td>
                        <td>Date ranges, age groups, price ranges</td>
                      </tr>
                      <tr>
                        <td><strong>LIST</strong></td>
                        <td>Partition by discrete values</td>
                        <td>Region, status, category codes</td>
                      </tr>
                      <tr>
                        <td><strong>HASH</strong></td>
                        <td>Partition by hash function</td>
                        <td>Even distribution, load balancing</td>
                      </tr>
                      <tr>
                        <td><strong>KEY</strong></td>
                        <td>Similar to HASH (MySQL's hash)</td>
                        <td>Automatic distribution</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="sql-command">
<pre><span class="comment">-- RANGE partitioning by date</span>
<span class="prompt">mysql></span> CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE,
    total_amount DECIMAL(10,2),
    status VARCHAR(20)
)
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

<span class="comment">-- RANGE partitioning by numeric value</span>
<span class="prompt">mysql></span> CREATE TABLE employees (
    employee_id INT PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    age INT,
    salary DECIMAL(10,2)
)
PARTITION BY RANGE (age) (
    PARTITION p_young VALUES LESS THAN (30),
    PARTITION p_middle VALUES LESS THAN (50),
    PARTITION p_senior VALUES LESS THAN (65),
    PARTITION p_max VALUES LESS THAN MAXVALUE
);

<span class="comment">-- LIST partitioning</span>
<span class="prompt">mysql></span> CREATE TABLE customers (
    customer_id INT PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    region VARCHAR(20)
)
PARTITION BY LIST COLUMNS(region) (
    PARTITION p_north VALUES IN ('North', 'Northeast', 'Northwest'),
    PARTITION p_south VALUES IN ('South', 'Southeast', 'Southwest'),
    PARTITION p_east VALUES IN ('East'),
    PARTITION p_west VALUES IN ('West')
);

<span class="comment">-- HASH partitioning (even distribution)</span>
<span class="prompt">mysql></span> CREATE TABLE products (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(200),
    price DECIMAL(10,2)
)
PARTITION BY HASH(product_id)
PARTITIONS 4;  <span class="comment">-- Creates 4 partitions</span>

<span class="comment">-- KEY partitioning</span>
<span class="prompt">mysql></span> CREATE TABLE logs (
    log_id INT PRIMARY KEY,
    log_message TEXT,
    log_date DATETIME
)
PARTITION BY KEY(log_id)
PARTITIONS 8;

<span class="comment">-- Add partition to existing table</span>
<span class="prompt">mysql></span> ALTER TABLE orders 
ADD PARTITION (PARTITION p2026 VALUES LESS THAN (2027));

<span class="comment">-- Drop partition (deletes data!)</span>
<span class="prompt">mysql></span> ALTER TABLE orders DROP PARTITION p2022;

<span class="comment">-- Reorganize partition</span>
<span class="prompt">mysql></span> ALTER TABLE orders 
REORGANIZE PARTITION p_future INTO (
    PARTITION p2026 VALUES LESS THAN (2027),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

<span class="comment">-- View partition information</span>
<span class="prompt">mysql></span> SELECT 
    TABLE_NAME,
    PARTITION_NAME,
    PARTITION_METHOD,
    PARTITION_EXPRESSION,
    TABLE_ROWS,
    DATA_LENGTH
FROM information_schema.PARTITIONS
WHERE TABLE_SCHEMA = 'company' AND TABLE_NAME = 'orders';

<span class="comment">-- Check which partition a row belongs to</span>
<span class="prompt">mysql></span> EXPLAIN PARTITIONS 
SELECT * FROM orders WHERE order_date = '2024-01-15';

<span class="comment">-- Remove partitioning</span>
<span class="prompt">mysql></span> ALTER TABLE orders REMOVE PARTITIONING;
</pre>
                </div>

                <div class="example-box">
                  <h5>Example: Monthly Partitioning for Large Log Table</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Create partitioned log table</span>
CREATE TABLE application_logs (
    log_id BIGINT AUTO_INCREMENT,
    log_date DATE NOT NULL,
    log_time TIME,
    log_level VARCHAR(10),
    message TEXT,
    PRIMARY KEY (log_id, log_date)
)
PARTITION BY RANGE (TO_DAYS(log_date)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    PARTITION p202404 VALUES LESS THAN (TO_DAYS('2024-05-01')),
    PARTITION p202405 VALUES LESS THAN (TO_DAYS('2024-06-01')),
    PARTITION p202406 VALUES LESS THAN (TO_DAYS('2024-07-01')),
    PARTITION p_current VALUES LESS THAN MAXVALUE
);

<span class="comment">-- Query benefits from partition pruning</span>
<span class="comment">-- Only scans April partition instead of entire table</span>
SELECT * FROM application_logs 
WHERE log_date BETWEEN '2024-04-01' AND '2024-04-30';

<span class="comment">-- Archive old data by dropping partition (instant!)</span>
ALTER TABLE application_logs DROP PARTITION p202401;
<span class="comment">-- Much faster than: DELETE FROM application_logs WHERE log_date < '2024-02-01'</span>

<span class="comment">-- Add new partition for next month</span>
ALTER TABLE application_logs 
REORGANIZE PARTITION p_current INTO (
    PARTITION p202407 VALUES LESS THAN (TO_DAYS('2024-08-01')),
    PARTITION p_current VALUES LESS THAN MAXVALUE
);
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.8 Useful SQL Patterns and Tips</h3>
                
                <div class="example-box">
                  <h5>Pattern 1: Find Duplicates</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Find duplicate emails</span>
SELECT email, COUNT(*) AS count
FROM customers
GROUP BY email
HAVING COUNT(*) > 1;

<span class="comment">-- Find all rows with duplicate emails</span>
SELECT c.*
FROM customers c
JOIN (
    SELECT email
    FROM customers
    GROUP BY email
    HAVING COUNT(*) > 1
) duplicates ON c.email = duplicates.email
ORDER BY c.email;

<span class="comment">-- Delete duplicates (keep oldest)</span>
DELETE c1 FROM customers c1
JOIN customers c2 
ON c1.email = c2.email 
AND c1.customer_id > c2.customer_id;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Pattern 2: Generate Date Series</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Generate dates for last 30 days</span>
WITH RECURSIVE date_series AS (
    SELECT CURDATE() - INTERVAL 29 DAY AS date
    UNION ALL
    SELECT date + INTERVAL 1 DAY
    FROM date_series
    WHERE date < CURDATE()
)
SELECT 
    ds.date,
    COALESCE(COUNT(o.order_id), 0) AS order_count,
    COALESCE(SUM(o.total_amount), 0) AS daily_revenue
FROM date_series ds
LEFT JOIN orders o ON DATE(o.order_date) = ds.date
GROUP BY ds.date
ORDER BY ds.date;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Pattern 3: Pivot Data (Rows to Columns)</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Pivot sales by month</span>
SELECT 
    product_id,
    product_name,
    SUM(CASE WHEN MONTH(order_date) = 1 THEN total ELSE 0 END) AS jan,
    SUM(CASE WHEN MONTH(order_date) = 2 THEN total ELSE 0 END) AS feb,
    SUM(CASE WHEN MONTH(order_date) = 3 THEN total ELSE 0 END) AS mar,
    SUM(CASE WHEN MONTH(order_date) = 4 THEN total ELSE 0 END) AS apr,
    SUM(CASE WHEN MONTH(order_date) = 5 THEN total ELSE 0 END) AS may,
    SUM(CASE WHEN MONTH(order_date) = 6 THEN total ELSE 0 END) AS jun
FROM (
    SELECT 
        p.product_id,
        p.product_name,
        o.order_date,
        oi.quantity * oi.unit_price AS total
    FROM products p
    JOIN order_items oi ON p.product_id = oi.product_id
    JOIN orders o ON oi.order_id = o.order_id
    WHERE YEAR(o.order_date) = 2024
) sales
GROUP BY product_id, product_name;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Pattern 4: Running Calculations</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Running total with window function</span>
SELECT 
    order_date,
    total_amount,
    SUM(total_amount) OVER (ORDER BY order_date) AS running_total,
    AVG(total_amount) OVER (
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS moving_avg_7days
FROM orders
ORDER BY order_date;

<span class="comment">-- Cumulative distinct count</span>
SELECT 
    order_date,
    COUNT(DISTINCT customer_id) OVER (
        ORDER BY order_date
        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
    ) AS cumulative_customers
FROM orders
ORDER BY order_date;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Pattern 5: Gap and Island Detection</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Find gaps in sequential IDs</span>
SELECT 
    t1.order_id + 1 AS gap_start,
    (SELECT MIN(order_id) - 1 
     FROM orders t3 
     WHERE t3.order_id > t1.order_id) AS gap_end
FROM orders t1
WHERE NOT EXISTS (
    SELECT 1 FROM orders t2 
    WHERE t2.order_id = t1.order_id + 1
)
AND t1.order_id < (SELECT MAX(order_id) FROM orders);

<span class="comment">-- Find consecutive login days (islands)</span>
WITH numbered AS (
    SELECT 
        customer_id,
        login_date,
        ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY login_date) AS rn,
        DATE_SUB(login_date, INTERVAL 
            ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY login_date) DAY
        ) AS group_date
    FROM customer_logins
)
SELECT 
    customer_id,
    MIN(login_date) AS streak_start,
    MAX(login_date) AS streak_end,
    COUNT(*) AS consecutive_days
FROM numbered
GROUP BY customer_id, group_date
HAVING COUNT(*) >= 7  <span class="comment">-- 7+ day streaks</span>
ORDER BY consecutive_days DESC;
</pre>
                  </div>
                </div>

                <div class="example-box">
                  <h5>Pattern 6: Dynamic SQL Generation</h5>
                  <div class="sql-command">
<pre><span class="comment">-- Generate UPDATE statements for all tables</span>
SELECT 
    CONCAT('UPDATE ', table_name, ' SET updated_at = NOW();') AS update_statement
FROM information_schema.tables
WHERE table_schema = 'company'
  AND table_type = 'BASE TABLE'
  AND EXISTS (
    SELECT 1 FROM information_schema.columns
    WHERE table_schema = 'company'
      AND table_name = tables.table_name
      AND column_name = 'updated_at'
  );

<span class="comment">-- Generate DROP statements for old partitions</span>
SELECT 
    CONCAT('ALTER TABLE ', table_name, 
           ' DROP PARTITION ', partition_name, ';') AS drop_statement
FROM information_schema.partitions
WHERE table_schema = 'company'
  AND partition_name LIKE 'p2022%';
</pre>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.9 MySQL Quick Reference</h3>
                
                <div class="subsection">
                  <h4 class="subsection-title">Essential Commands Cheat Sheet</h4>
                  <div class="code-box">
<pre><strong>DATABASE OPERATIONS:</strong>
SHOW DATABASES;
CREATE DATABASE db_name;
USE db_name;
DROP DATABASE db_name;

<strong>TABLE OPERATIONS:</strong>
SHOW TABLES;
DESCRIBE table_name;
SHOW CREATE TABLE table_name;
CREATE TABLE ... ;
ALTER TABLE ... ;
DROP TABLE table_name;
TRUNCATE TABLE table_name;

<strong>DATA OPERATIONS:</strong>
SELECT * FROM table;
INSERT INTO table VALUES (...);
UPDATE table SET ... WHERE ...;
DELETE FROM table WHERE ...;

<strong>INDEX OPERATIONS:</strong>
CREATE INDEX idx_name ON table(column);
SHOW INDEX FROM table;
DROP INDEX idx_name ON table;

<strong>USER MANAGEMENT:</strong>
CREATE USER 'user'@'host' IDENTIFIED BY 'password';
GRANT privileges ON db.* TO 'user'@'host';
REVOKE privileges ON db.* FROM 'user'@'host';
DROP USER 'user'@'host';
SHOW GRANTS FOR 'user'@'host';

<strong>INFORMATION:</strong>
SHOW PROCESSLIST;
SHOW STATUS;
SHOW VARIABLES;
EXPLAIN SELECT ... ;

<strong>BACKUP/RESTORE:</strong>
mysqldump -u user -p db > backup.sql
mysql -u user -p db < backup.sql
</pre>
                  </div>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Common Data Types Quick Reference</h4>
                  <div class="comparison-table">
                    <thead>
                      <tr>
                        <th>Category</th>
                        <th>Common Types</th>
                        <th>When to Use</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><strong>Integers</strong></td>
                        <td>TINYINT, INT, BIGINT</td>
                        <td>IDs, counts, flags, ages</td>
                      </tr>
                      <tr>
                        <td><strong>Decimals</strong></td>
                        <td>DECIMAL(10,2)</td>
                        <td>Money, prices, precise calculations</td>
                      </tr>
                      <tr>
                        <td><strong>Strings</strong></td>
                        <td>VARCHAR(255), TEXT</td>
                        <td>Names, descriptions, emails</td>
                      </tr>
                      <tr>
                        <td><strong>Dates</strong></td>
                        <td>DATE, DATETIME, TIMESTAMP</td>
                        <td>Birth dates, created_at, updated_at</td>
                      </tr>
                      <tr>
                        <td><strong>Boolean</strong></td>
                        <td>BOOLEAN (TINYINT(1))</td>
                        <td>True/false flags (is_active, is_deleted)</td>
                      </tr>
                      <tr>
                        <td><strong>Enums</strong></td>
                        <td>ENUM('value1','value2')</td>
                        <td>Fixed list of values (status, type)</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="subsection">
                  <h4 class="subsection-title">Performance Optimization Checklist</h4>
                  <div class="component-grid">
                    <div class="component-card">
                      <h4>✅ Query Level</h4>
                      <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                        • Select only needed columns<br>
                        • Use LIMIT for large results<br>
                        • Use EXPLAIN to analyze<br>
                        • Avoid SELECT *
                      </p>
                    </div>
                    
                    <div class="component-card">
                      <h4>✅ Index Level</h4>
                      <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                        • Index WHERE columns<br>
                        • Index JOIN columns<br>
                        • Index ORDER BY columns<br>
                        • Use composite indexes
                      </p>
                    </div>
                    
                    <div class="component-card">
                      <h4>✅ Schema Level</h4>
                      <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                        • Normalize database<br>
                        • Use appropriate data types<br>
                        • Add foreign keys<br>
                        • Consider partitioning
                      </p>
                    </div>
                    
                    <div class="component-card">
                      <h4>✅ Server Level</h4>
                      <p style="text-align: left; font-size: 0.9em; margin-top: 10px;">
                        • Optimize buffer pool<br>
                        • Enable query cache<br>
                        • Monitor slow queries<br>
                        • Regular maintenance
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="section">
                <h3 class="section-title">9.10 Best Practices Summary</h3>
                
                <div class="highlight-box">
                  <p><strong>🎯 Database Design Best Practices:</strong></p>
                  <ul>
                    <li>✅ Normalize to 3NF for OLTP, denormalize for OLAP/reporting</li>
                    <li>✅ Use meaningful, consistent naming conventions</li>
                    <li>✅ Always define PRIMARY KEY on every table</li>
                    <li>✅ Use Foreign Keys to enforce referential integrity</li>
                    <li>✅ Choose appropriate data types (smallest that fits)</li>
                    <li>✅ Use NOT NULL when possible (helps with optimization)</li>
                    <li>✅ Document complex logic and relationships</li>
                  </ul>
                </div>

                <div class="highlight-box">
                  <p><strong>⚡ Query Best Practices:</strong></p>
                  <ul>
                    <li>✅ Use prepared statements (prevent SQL injection)</li>
                    <li>✅ Index frequently queried columns</li>
                    <li>✅ Use JOINs instead of subqueries when possible</li>
                    <li>✅ Use EXPLAIN to analyze query execution</li>
                    <li>✅ Avoid functions on indexed columns in WHERE</li>
                    <li>✅ Use LIMIT for pagination</li>
                    <li>✅ Cache frequently accessed data</li>
                  </ul>
                </div>

                <div class="highlight-box">
                  <p><strong>🔒 Security Best Practices:</strong></p>
                  <ul>
                    <li>✅ Never use root for applications</li>
                    <li>✅ Apply principle of least privilege</li>
                    <li>✅ Use strong passwords and enforce expiration</li>
                    <li>✅ Enable SSL/TLS for remote connections</li>
                    <li>✅ Regularly update MySQL and apply patches</li>
                    <li>✅ Monitor and audit user activity</li>
                    <li>✅ Backup regularly and test restores</li>
                  </ul>
                </div>

                <div class="highlight-box">
                  <p><strong>🛠️ Maintenance Best Practices:</strong></p>
                  <ul>
                    <li>✅ Schedule regular backups (automated)</li>
                    <li>✅ Monitor disk space and table sizes</li>
                    <li>✅ Optimize tables periodically</li>
                    <li>✅ Review and remove unused indexes</li>
                    <li>✅ Archive or partition old data</li>
                    <li>✅ Monitor slow query log</li>
                    <li>✅ Keep MySQL up to date</li>
                  </ul>
                </div>

                <div class="warning-box">
                  <strong>❌ Common Mistakes to Avoid:</strong>
                  <ul>
                    <li>❌ Using SELECT * in production code</li>
                    <li>❌ Not backing up databases regularly</li>
                    <li>❌ Storing passwords in plain text</li>
                    <li>❌ Not using indexes on foreign keys</li>
                    <li>❌ Over-indexing (too many indexes)</li>
                    <li>❌ Using VARCHAR when fixed CHAR is better</li>
                    <li>❌ Not testing queries with EXPLAIN</li>
                    <li>❌ Ignoring slow query log</li>
                    <li>❌ Not documenting database schema</li>
                    <li>❌ Running MySQL as root user</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

        </div>
      </main>
    </div>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      }

      function closeSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      }

      // Close sidebar when clicking a link
      document.querySelectorAll('.sidebar a').forEach(link => {
        link.addEventListener('click', () => {
          closeSidebar();
        });
      });
    </script>
  </body>
</html>